
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

:root{
  /* App palette (requested) */
  --bg0:#0B1020;            /* Background */
  --bg1:#0B1020;            /* Background */
  --panel:#1A1F36;          /* Surface */
  --card:#1A1F36;           /* Surface */
  --surfaceActive:#242B4A;  /* Surface Active */
  --divider:#2E3455;        /* Divider */

  --glass:rgba(255,255,255,.06);
  --glass2:rgba(255,255,255,.03);

  --accent:#6A6EFF;         /* CTA Primary */
  --accent2:#6A6EFF;
  --success:#22c55e;
  --warn:#f59e0b;
  --danger:#ef4444;
  --text:#FFFFFF;           /* Text Primary */
  --muted:#A8ADCC;          /* Text Secondary */
  --muted2:#7E84A8;         /* Text Tertiary */
  --border:var(--divider);
  --shadow: 0 20px 50px rgba(0,0,0,.55);
  --radius-sm: 12px;
  --radius-md: 14px;
  --radius-lg: 16px;
  /* Typography tokens */
  --h1-size: 2.05rem;
  --h1-weight: 800;
  --h1-letter: -0.045em;

  --section-size: 1.05rem;
  --section-weight: 650;
  --section-letter: -0.02em;

  --body-size: .95rem;
  --body-weight: 450;
  --body-color: rgba(229,231,235,.78);

  --label-size: .82rem;
  --label-color: rgba(148,163,184,.78);

  --micro-size: .78rem;
  --micro-color: rgba(148,163,184,.6);


/* Topbar theme (Habits). Change only these to recolor the new top bar. */
--tb-bg0:#070a16;
--tb-bg1:#0b1030;
--tb-glass: rgba(160, 60, 255, .18);
--tb-stroke: rgba(255,255,255,.10);
--tb-stroke2: rgba(255,255,255,.14);
--tb-txt: rgba(255,255,255,.92);
--tb-muted: rgba(255,255,255,.70);


  /* Habits topbar mobile palette (<=560px). Change only these for small-screen colors. */
  --tbm-bg1:#221a3c;
  --tbm-bg2:#1a1533;
  --tbm-muted:rgba(255,255,255,.6);
}

/* Big-screen typography + spacing scale */
@media (min-width: 1400px){
  :root{
    --h1-size: 2.35rem;
    --section-size: 1.15rem;
    --body-size: 1.02rem;
    --label-size: .88rem;
    --micro-size: .82rem;
  }
  .content{ padding: 44px 54px 74px; max-width: 1440px; }
  .sidebar{ padding: 26px 22px; }
  .nav a{ padding: 13px 14px; }
  .pill{ font-size: .8rem; }
}

@media (min-width: 1700px){
  :root{
    --h1-size: 2.6rem;
    --section-size: 1.22rem;
    --body-size: 1.08rem;
    --label-size: .92rem;
    --micro-size: .86rem;
  }
  .content{ max-width: 1560px; }
}


*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:var(--text);
  /* Requested: remove the "lighter band" / uneven top glow so backgrounds feel uniform across screens. */
  background: var(--bg0);
}

a{color:inherit}
.layout{
  display:grid;
  grid-template-columns: 280px 1fr;
  min-height:100vh;
  animation: fadeIn .32s ease;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

.sidebar{
  position:sticky;
  top:0;
  height:100vh;
  background: rgba(2,6,23,.82);
  backdrop-filter: blur(14px);
  border-right: 1px solid var(--border);
  padding: 22px 18px;
  display:flex;
  flex-direction:column;
  gap: 14px;
}
.brand{
  display:flex;
  align-items:center;
  gap:12px;
  padding: 12px 12px;
  border-radius: 18px;
  background: linear-gradient(180deg, rgba(99,102,241,.14), rgba(255,255,255,.02));
  border: 1px solid rgba(99,102,241,.22);
  box-shadow: 0 10px 30px rgba(0,0,0,.35);
}
.logoDot{display:none;}
.brandTitle{font-weight:800;letter-spacing:-.03em}
.brandSub{font-size:.85rem;color:var(--muted);margin-top:2px}

.nav{
  display:flex;
  flex-direction:column;
  gap: 6px;
  margin-top: 4px;
}
.nav a{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 8px;
  text-decoration:none;
  color: var(--muted);
  padding: 12px 12px;
  border-radius: 14px;
  border: 1px solid transparent;
  position: relative;
  transition: transform .15s ease, background .18s ease, border-color .18s ease, color .18s ease;
}
.nav a .left{display:flex;align-items:center;gap:10px}
.nav a:hover{
  background: rgba(99,102,241,.08);
  border-color: rgba(99,102,241,.18);
  color: #fff;
  transform: translateX(2px);
}
.nav a.active{
  background: rgba(99,102,241,.06);
  border-color: rgba(99,102,241,.22);
  color: #fff;
  box-shadow: none;
}

/* Active indicator (sidebar): 2px accent line */
.nav a.active::before{
  content:"";
  position:absolute;
  left:0;
  top:10px;
  bottom:10px;
  width:2px;
  border-radius: 2px;
  background: var(--accent);
}

/* Make the right-side badge feel "selected" too */
.nav a.active .pill{
  background: rgba(2,6,23,.45);
  border-color: rgba(99,102,241,.35);
  color: rgba(255,255,255,.86);
}

/* --- Nav icon visibility (stable, no glow) --- */

.nav a .iconWrap,
.bottomNav a .iconWrap{
  width: 22px;
  height: 22px;
  display: grid;
  place-items: center;
  flex: 0 0 auto;
}
.bottomNav a .iconWrap{ width: 20px; height: 20px; }

.nav a .iconWrap img,
.bottomNav a .iconWrap img{
  width: 100%;
  height: 100%;
  display: block;
  object-fit: contain;
  opacity: .65;
  transform: scale(1);
  transition: transform .14s ease-out, opacity .14s ease-out, filter .14s ease-out;
}

.nav a.active .iconWrap img,
.bottomNav a.active .iconWrap img{
  opacity: 1;
  transform: scale(1.08);
}

/* Depth only for Habits icon when active */
.nav a.active[href*="habits"] .iconWrap img,
.bottomNav a.active[href*="habits"] .iconWrap img{
  filter: drop-shadow(0 2px 6px rgba(0,0,0,0.14));
}

/* Habits: larger icon for better visibility on big screens */
@media (min-width: 1200px){
  .nav a[href*="habits"] .iconWrap{ width: 30px; height: 30px; }
}

.pill{
  font-size:.75rem;
  color: var(--muted);
  border: 1px solid var(--border);
  padding: 4px 8px;
  border-radius: 999px;
  background: rgba(255,255,255,.02);
}

.sidebarFooter{
  margin-top:auto;
  padding: 12px 12px;
  border-radius: 16px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,.02);
  color: var(--muted);
  font-size: .85rem;
}

.content{
  /* Add keyboard-safe bottom padding via --kb (set by app.js using VisualViewport) */
  padding: 34px 36px calc(60px + var(--kb, 0px));
  max-width: 1280px;
  width: 100%;
}

/* Dashboard layout */
.dashHero{
  position:relative;
  overflow:hidden;
  border-color: rgba(99,102,241,.28);
  background:
    radial-gradient(700px 280px at 12% 20%, rgba(99,102,241,.28) 0%, transparent 58%),
    radial-gradient(600px 260px at 90% 40%, rgba(34,197,94,.12) 0%, transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
}
.dashHeroTop{display:flex;align-items:flex-start;justify-content:space-between;gap:16px}
.dashHeroTitle{font-size:1.2rem;font-weight:800;letter-spacing:-.03em;margin-bottom:6px}
.dashHeroPills{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}

.dashSplit{display:grid;grid-template-columns: 1.25fr .9fr;gap:18px;align-items:start}
.dashCol{display:flex;flex-direction:column;gap:12px;min-width:0}
.dashSectionTitle{color:var(--muted);font-size:.82rem;letter-spacing:.12em;text-transform:uppercase;margin:4px 2px}
.dashKpis{display:grid;grid-template-columns: repeat(3, minmax(0,1fr));gap:12px}
.kpi{padding:16px 16px}
.kpiLabel{font-size: var(--label-size); color: var(--label-color);}
.kpiValue{font-size: 1.35rem; font-weight: 750; letter-spacing: -0.02em; color:#fff; margin-top:4px}
.kpiRow{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}

.dashStack{display:flex;flex-direction:column;gap:14px}

.miniList{display:flex;flex-direction:column;gap:10px;margin-top:10px}
.miniRow{display:flex;align-items:center;justify-content:space-between;gap:10px;padding: 10px 10px;border-radius:16px;border:1px solid var(--border);background:rgba(255,255,255,.02)}
.miniLeft{display:flex;flex-direction:column;gap:2px;min-width:0}
.miniTitle{font-weight:650;letter-spacing:-.01em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.miniMeta{font-size:.82rem;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.miniVal{font-weight:800;letter-spacing:-.02em}

@media (max-width: 1040px){
  .dashSplit{grid-template-columns: 1fr}
}
@media (max-width: 760px){
  /* Mobile has a fixed bottom nav; keep interactive controls above it */
  .content{padding: 28px 16px calc(92px + env(safe-area-inset-bottom) + var(--kb, 0px))}
  .layout{grid-template-columns: 1fr}
  .sidebar{position:relative;height:auto}
  .dashKpis{grid-template-columns: 1fr}
  .dashHeroTop{flex-direction:column}
  .dashHeroPills{justify-content:flex-start}
}
.topbar{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 16px;
  margin-bottom: 18px;
}
.pageTitle{
  margin:0;
  font-size: var(--h1-size);
  font-weight: var(--h1-weight);
  letter-spacing: var(--h1-letter);
  color: #fff;
}
.subtitle{
  margin: 6px 0 0;
  color: var(--label-color);
  font-size: var(--body-size);
  font-weight: 450;
}

.actionsRow{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn,button{
  position:relative;
  background: linear-gradient(180deg, rgba(99,102,241,.98), rgba(129,140,248,.92));
  color:#fff;
  border: 1px solid rgba(99,102,241,.45);
  padding: 11px 14px;
  border-radius: 16px;
  cursor:pointer;
  font-weight: 700;
  letter-spacing: -.01em;
  box-shadow:
    0 10px 28px rgba(99,102,241,.22),
    inset 0 1px 0 rgba(255,255,255,.18);
  transition: transform .12s ease, box-shadow .12s ease, filter .12s ease, background .12s ease;
}
.btn::after,button::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius: inherit;
  background: radial-gradient(120px 60px at 25% 10%, rgba(255,255,255,.22), transparent 60%);
  pointer-events:none;
  opacity:.85;
}
.btn.secondary{
  background: rgba(255,255,255,.045);
  border: 1px solid rgba(148,163,184,.22);
  color: var(--text);
  box-shadow:
    0 10px 24px rgba(0,0,0,.35),
    inset 0 1px 0 rgba(255,255,255,.10);
}
.btn.ghost{
  background: transparent;
  border: 1px solid rgba(148,163,184,.18);
  color: var(--text);
  box-shadow: none;
}
.btn:hover,button:hover{
  transform:translateY(-2px);
  filter: brightness(1.06);
  box-shadow:
    0 16px 40px rgba(99,102,241,.28),
    inset 0 1px 0 rgba(255,255,255,.22);
}
.btn.secondary:hover{
  background: rgba(255,255,255,.06);
  box-shadow: 0 16px 40px rgba(0,0,0,.45);
}
.btn.ghost:hover{
  background: rgba(255,255,255,.04);
  box-shadow: 0 14px 34px rgba(0,0,0,.35);
}
.btn:active,button:active{transform:translateY(0) scale(.98)}
.btn:focus-visible,button:focus-visible{
  outline:none;
  box-shadow:
    0 0 0 4px rgba(99,102,241,.18),
    0 16px 40px rgba(99,102,241,.26),
    inset 0 1px 0 rgba(255,255,255,.22);
}

input,select{
  background: rgba(2,6,23,.55);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 12px 14px;
  border-radius: var(--radius-sm);
  outline: none;
  transition: border-color .15s ease, box-shadow .15s ease;
}
input:focus,select:focus{
  border-color: rgba(99,102,241,.45);
  box-shadow: 0 0 0 4px rgba(99,102,241,.15);
}

.grid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 18px;
}

/* Habits: templates + analytics */
.templateGrid{display:flex;flex-direction:column;gap:10px;margin-top:12px}
.templateItem{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 12px;border-radius:18px;border:1px solid var(--border);background:rgba(255,255,255,.02)}
.templateTitle{font-weight:750;letter-spacing:-.02em}

.analyticsTop{display:grid;grid-template-columns: 1fr .9fr;gap:14px;align-items:start}
.analyticsSide{display:flex;flex-direction:column;gap:10px}
.statCard{padding:12px 12px;border-radius:18px;border:1px solid var(--border);background:rgba(255,255,255,.02)}
.statLabel{color:var(--muted);font-size:.8rem;letter-spacing:.12em;text-transform:uppercase}
.statValue{font-size:1.25rem;font-weight:850;letter-spacing:-.03em;margin-top:4px}
.statHint{color:var(--muted);font-size:.85rem;margin-top:6px;line-height:1.2}

.heatmap{border:1px solid var(--border);border-radius:18px;background:rgba(255,255,255,.02);padding:12px;overflow:hidden}
.heatmapHeader{display:grid;grid-template-columns: 56px repeat(7, 1fr);gap:8px;align-items:center;margin-bottom:10px}
.heatLabel{font-size:.75rem;color:var(--muted);text-align:center;letter-spacing:.06em}
.heatmapBody{display:flex;flex-direction:column;gap:8px}
.heatRow{display:grid;grid-template-columns: 56px 1fr;gap:8px;align-items:center}
.heatWeek{font-size:.72rem;color:var(--muted)}
.heatCells{display:grid;grid-template-columns: repeat(7, 1fr);gap:8px}
.heatCell{
  aspect-ratio:1/1;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.07);
  background: rgba(255,255,255,.04);
  cursor:pointer;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
  transition: transform .12s ease, filter .12s ease, box-shadow .12s ease, border-color .12s ease;
}
.heatCell:hover{
  transform:translateY(-2px);
  filter:brightness(1.10);
  border-color: rgba(129,140,248,.35);
  box-shadow:
    0 10px 24px rgba(99,102,241,.22),
    inset 0 1px 0 rgba(255,255,255,.08);
}
.heatCell:active{transform:translateY(-1px) scale(.98)}

/* Habits: matrix analytics (dates x habits) */
.matrixWrap{
  position: relative;
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 18px;
  background: linear-gradient(180deg, rgba(255,255,255,.028), rgba(255,255,255,.012));
  padding: 12px;
  overflow: auto;
  /* Prevent mobile overscroll from revealing background seams */
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}

/* Subtle background strip behind the sticky Dates column so it reads as a dedicated panel. */
.matrixWrap::before{
  content: "";
  position: absolute;
  inset: 0;
  width: calc(var(--dateCol, 190px) + var(--between, 12px));
  background: linear-gradient(90deg, rgba(255,255,255,.035), rgba(255,255,255,0));
  border-radius: 18px;
  pointer-events: none;
  opacity: .45;
}
.matrixGrid{display:grid;--mgap:8px;gap:var(--mgap);min-width:100%;--cell:54px;--dateCol:190px;--between:12px}
.matrixHeaderRow{
  display:grid;
  gap: var(--mgap, 8px);
  position: sticky;
  top: 0;
  z-index: 3;
  
  /* Closed, card-like header rail */
  background: linear-gradient(180deg, rgba(15,23,42,.72), rgba(2,6,23,.52));
  border: 0;
  border-radius: 16px;
  /* IMPORTANT: no horizontal padding here, иначе header колоните се разминават с редовете */
  padding: 0;
  margin-bottom: 10px;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.06),
    inset 0 1px 0 rgba(255,255,255,.06),
    0 14px 36px rgba(0,0,0,.28);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

/* Visual spacer column between the sticky date rail and the habit grid */
.matrixSpacer{
  width: var(--between, 12px);
  /* keep it purely structural (no negative margins) so header + rows align perfectly */
}
.matrixRow{display:grid;gap: var(--mgap, 8px);align-items:center}
.matrixCorner{
  position: sticky;
  left: 0;
  z-index: 4;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.10);
  background: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.02));
  padding: 10px 12px;
  /* Typography */
  color: rgba(255,255,255,.92);
  /* Layout */
  display:flex;
  flex-direction: column;
  align-items:flex-start;
  justify-content:center;
  min-height: 54px;
  overflow:hidden;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
}
.matrixCorner .mcLabel{
  font-size: .70rem;
  letter-spacing: .12em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 4px;
}
.matrixCorner .mcRange{
  font-size: .92rem;
  font-weight: 750;
  letter-spacing: -.015em;
  display:flex;
  align-items: baseline;
  gap: 6px;
  line-height: 1.1;
}
.matrixCorner .mcSep{
  opacity: .55;
}

.matrixHabit{
  --habit-accent: var(--accent);
  width: 100%;
  justify-self: stretch;

  /* Make header tiles exactly the same footprint as grid cells to avoid any perceived offset */
  height: var(--cell, 54px);
  display: flex;
  align-items: center;
  justify-content: center;

  border-radius: 12px;
  border: 1px solid color-mix(in oklab, var(--habit-accent) 22%, rgba(255,255,255,.08));
  background: color-mix(in oklab, var(--habit-accent) 10%, rgba(255,255,255,.03));

  padding: 0; /* <- critical for perfect alignment */
  font-size: .8rem;
  font-weight: 650;
  letter-spacing: -.01em;

  color: rgba(255,255,255,.92);
  overflow: hidden;
  text-align: center;
}

.matrixHabit > span{
  display:block;
  padding: 0 8px;
  max-width: 100%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.matrixDate{
  position: sticky;
  left: 0;
  z-index: 2;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.08);
  background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
  padding: 10px 10px;
  line-height: 1.15;
}
.matrixRow:hover .matrixDate{
  border-color: rgba(255,255,255,.12);
  background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
}
.matrixRow.today .matrixDate{
  border-color: rgba(99,102,241,.35);
  box-shadow: 0 10px 24px rgba(99,102,241,.16), inset 0 1px 0 rgba(255,255,255,.06);
}
.matrixDate .d1{font-weight:700;letter-spacing:-.02em}
.matrixDate .d2{font-size:.75rem;color:var(--muted);margin-top:2px}

/* Mobile transpose layout: first column is the habit name (sticky like dates). */
.matrixHabitName{
  --habit-accent: var(--accent);
  position: sticky;
  left: 0;
  z-index: 2;
  border-radius: 12px;
  border: 1px solid color-mix(in oklab, var(--habit-accent) 22%, rgba(255,255,255,.08));
  background: color-mix(in oklab, var(--habit-accent) 10%, rgba(255,255,255,.02));
  padding: 10px 10px;
  font-weight: 700;
  letter-spacing: -.01em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.matrixHabitName span{
  display:block;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  /* Keep text readable on green/yellow accents */
  color: rgba(255,255,255,.92);
}

/* Mobile day chip: month / day+weekday in exactly 2 rows */
.matrixDayHead{ overflow: hidden; }
.matrixDayHead .d1, .matrixDayHead .d2{ line-height: 1.05; }
.matrixDayHead .m{
  display:inline-block;
  max-width: 2ch;
  white-space: nowrap;
  overflow: hidden;
  font-weight: 850;
  font-size: clamp(.66rem, 2.2vw, .82rem);
  letter-spacing: .02em;
}
.matrixDayHead .d2{
  display:flex;
  gap: .18rem;
  justify-content: center;
  align-items: baseline;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}
.matrixDayHead .n{
  font-weight: 900;
  font-size: clamp(.78rem, 2.7vw, .98rem);
}
.matrixDayHead .w{
font-weight: 750;
  font-size: clamp(.62rem, 2.0vw, .78rem);
  opacity: .9;
  display:inline-block;
  max-width: 3ch;
  white-space: nowrap;
  overflow: hidden;
}

@media (max-width: 520px){
  .matrixDayHead{padding: 7px 6px; border-radius: 10px}
  /* sizes handled via clamp(); keep only spacing tweaks here */
  .matrixDayHead .d2{ margin-top: 1px }
  .yearMonths{grid-template-columns: 1fr;}
}

.matrixDayHead{
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.03);
  padding: 10px 10px;
  text-align:center;
  font-weight: 750;
  letter-spacing: -.01em;
}
.matrixDayHead .d1{margin-top: 0}
.matrixDayHead .d2{color:var(--muted);margin-top:2px}

@media (max-width: 420px){
  /* Tighter day chips so dates stay fully inside their boxes on small screens */
  .matrixDayHead{padding: 6px 6px; border-radius: 10px}
  .matrixDayHead .d1{word-break: break-word}
  .matrixDayHead .d2{ margin-top: 1px }
}
.matrixCell{touch-action:none;
  --habit-accent: var(--accent);
  aspect-ratio: 1/1;
  width: 100%;
  justify-self: stretch;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.07);
  /* default = neutral/grey until marked */
  background: rgba(255,255,255,.04);
  cursor: pointer;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
  transition: transform .12s ease, filter .12s ease, box-shadow .12s ease, border-color .12s ease;
}

.matrixCell.done{
  background: color-mix(in oklab, var(--habit-accent) 65%, transparent);
  border-color: color-mix(in oklab, var(--habit-accent) 28%, rgba(255,255,255,.07));
}

.matrixCell.missed{
  /* keep unmarked states neutral (no accent) */
  background: rgba(255,255,255,.03);
  border-color: rgba(255,255,255,.06);
  opacity: .60;
}
.matrixCell:hover{
  transform: translateY(-2px);
  filter: brightness(1.10);
  /* hover on empty/missed stays neutral */
  border-color: rgba(255,255,255,.14);
  box-shadow:
    0 10px 24px rgba(0,0,0,.22),
    inset 0 1px 0 rgba(255,255,255,.08);
}

.matrixCell.done:hover{
  border-color: color-mix(in oklab, var(--habit-accent) 55%, rgba(255,255,255,.14));
  box-shadow:
    0 12px 28px color-mix(in oklab, var(--habit-accent) 35%, transparent),
    inset 0 1px 0 rgba(255,255,255,.08);
}
.matrixCell.done:hover{
  /* only completed cells get the accent hover */
  border-color: color-mix(in oklab, var(--habit-accent) 45%, rgba(255,255,255,.12));
  box-shadow:
    0 10px 24px color-mix(in oklab, var(--habit-accent) 35%, transparent),
    inset 0 1px 0 rgba(255,255,255,.08);
}
.matrixCell:active{transform:translateY(-1px) scale(.98)}

@keyframes cellPulse{
  0%{box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 0 0 0 color-mix(in oklab, var(--habit-accent) 45%, transparent)}
  60%{box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 0 0 8px color-mix(in oklab, var(--habit-accent) 40%, transparent), 0 14px 30px color-mix(in oklab, var(--habit-accent) 25%, transparent)}
  100%{box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 0 0 0 color-mix(in oklab, var(--habit-accent) 0%, transparent)}
}
@keyframes cellPulseMiss{
  0%{box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 0 0 0 rgba(255,90,90,.0)}
  60%{box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 0 0 8px rgba(255,90,90,.22), 0 14px 30px rgba(255,90,90,.12)}
  100%{box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 0 0 0 rgba(255,90,90,.0)}
}
.matrixCell.justChanged{animation: cellPulse .28s ease-out}
.matrixCell.justChanged.pulseMiss{animation: cellPulseMiss .28s ease-out}

.matrixRow:hover .matrixDate{
  border-color: rgba(255,255,255,.14);
  background: rgba(255,255,255,.04);
}
.matrixRow:hover .matrixCell{touch-action:none;
  filter: brightness(1.06);
}

/* Completed cells are color-only (no checkmark). */
.matrixCell.done::after{ content:""; display:none; }

.matrixCell.missed::after{ content:""; display:none; }

.habitTitleRow{display:flex;gap:10px;align-items:flex-start}
.habitDot{
  width: 10px;
  height: 10px;
  border-radius: 999px;
  margin-top: 5px;
  background: var(--habit-accent, var(--accent));
  box-shadow: 0 0 0 4px color-mix(in oklab, var(--habit-accent, var(--accent)) 18%, transparent);
}
.habitStatusPills{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}


@media (max-width: 520px){
  .matrixCell{touch-action:none;width: var(--cell, 44px);border-radius:10px}
}

@media (max-width: 1040px){
  .analyticsTop{grid-template-columns: 1fr}
}
\.card{
  background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
  border: 1px solid rgba(30,41,59,.9);
  border-radius: var(--radius-lg);
  padding: 18px 18px;
  box-shadow: var(--shadow);
}
.card.soft{
  background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  box-shadow: 0 14px 40px rgba(0,0,0,.45);
}
.cardHeader{
  display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;
}
.cardTitle{
  margin:0;
  font-size: var(--section-size);
  font-weight: var(--section-weight);
  letter-spacing: var(--section-letter);
  color: rgba(255,255,255,.88);
}
.metric{
  font-size: 2rem;
  font-weight: 800;
  letter-spacing: -.04em;
  margin: 6px 0 0;
}
.small{
  color: var(--micro-color);
  font-size: var(--micro-size);
  font-weight: 450;
}
.badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.badge{
  display:inline-flex;align-items:center;gap:8px;
  padding:6px 10px;border-radius:999px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,.02);
  color: var(--muted);
  font-size: .82rem;
}
.badge.ok{border-color:rgba(34,197,94,.35);color:var(--success);background:rgba(34,197,94,.08)}
.badge.warn{border-color:rgba(245,158,11,.35);color:var(--warn);background:rgba(245,158,11,.08)}
.badge.danger{border-color:rgba(239,68,68,.35);color:var(--danger);background:rgba(239,68,68,.08)}

.hr{height:1px;background:var(--border);margin:14px 0;border:0}

/* Table */
.table{width:100%;border-collapse:separate;border-spacing:0 10px}
.table th{color:var(--muted);font-weight:600;text-align:left;font-size:.85rem;padding:0 10px}
.table td{
  background: rgba(255,255,255,.03);
  padding: 12px 12px;
  border-top: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
}
.table tr td:first-child{
  border-left: 1px solid var(--border);
  border-top-left-radius: 14px;
  border-bottom-left-radius: 14px;
}
.table tr td:last-child{
  border-right: 1px solid var(--border);
  border-top-right-radius: 14px;
  border-bottom-right-radius: 14px;
}

/* Mini bar */
.miniBar{height:10px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
.miniBar>div{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2))}

/* Toast */
.toast{
  position:fixed;bottom:24px;right:24px;
  background: rgba(34,197,94,.14);
  color: var(--success);
  border: 1px solid rgba(34,197,94,.35);
  padding: 14px 16px;
  border-radius: 16px;
  backdrop-filter: blur(10px);
  animation: toastIn .22s ease;
  box-shadow: 0 16px 40px rgba(0,0,0,.5);
}
@keyframes toastIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

/* Responsive */
@media (max-width: 960px){
  .layout{grid-template-columns: 1fr}
  .sidebar{position:relative;height:auto}
  .content{padding:22px 18px 44px}
}

/* Modal (shared)
   Fix: the modal must open on desktop too.
   We show the backdrop whenever `.modal.open` is present (no extra `.show` class required). */
.modal{display:none; position:fixed; inset:0; z-index: 1000;}
.modal.open{display:block}

.modalBackdrop{
  position:fixed; inset:0;
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(6px);
  display:none;
  align-items:center;
  justify-content:center;
  padding: 18px;
}
.modal.open .modalBackdrop{display:flex; animation: fadeInModal .18s ease}
@keyframes fadeInModal{from{opacity:0}to{opacity:1}}

/* Desktop modal layout (mobile overrides later) */
@media (min-width: 761px){
  .modalSheet{
    position: fixed;
    left: 50%;
    top: 50%;
    width: min(600px, calc(100vw - 56px));
    border-radius: 22px;
    border: 1px solid var(--divider);
    background: linear-gradient(180deg, color-mix(in oklab, var(--panel) 92%, #000 8%), var(--panel));
    box-shadow: 0 26px 80px rgba(0,0,0,0.66);
    padding: 22px;
    transform: translate(-50%, calc(-50% + 10px));
    opacity: 0;
    z-index: 1001;
  }
  .modal.open .modalSheet{animation: desktopModalIn .18s ease-out forwards}
  @keyframes desktopModalIn{to{transform:translate(-50%, -50%); opacity:1}}
}
.modalHeader{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px}
.modalTitle{margin:0;font-size:1.22rem;font-weight:800;letter-spacing:-.035em}
.modalBody{display:flex;flex-direction:column;gap:10px}
.modalBody .small{color:var(--muted2)}

.modalInput{height:46px;font-size:.98rem;border-radius:14px}

.modalActions{display:flex;justify-content:flex-end;gap:10px;margin-top:14px}
.modalActions .btn{height:40px;min-width:108px;border-radius:14px}

.iconBtn{
  width: 36px;
  height: 36px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  background: color-mix(in oklab, var(--panel) 88%, #000 12%);
  border: 1px solid var(--divider);
  color: var(--text);
  border-radius: 12px;
  cursor:pointer;
  line-height: 1;
}
.iconBtn:hover{filter:brightness(1.06)}


/* Habits: per-habit analytics controls + mini heat preview */
.analyticsControls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.select{
  background:rgba(255,255,255,.04);
  border:1px solid var(--border);
  color:var(--text);
  border-radius:14px;
  padding:8px 10px;
  outline:none;
}
.select:focus{box-shadow:0 0 0 4px rgba(124,92,255,.18)}
.analyticsContext{display:flex;justify-content:space-between;gap:10px;margin-top:8px;margin-bottom:10px}
.miniHeatWrap{margin-top:12px}
.miniHeat{display:grid;grid-template-columns:repeat(7, minmax(0, 1fr));gap:6px}
.miniCell{height:12px;border-radius:6px;border:1px solid rgba(255,255,255,.07);background:rgba(255,255,255,.04);transition:transform .12s ease, filter .12s ease, box-shadow .12s ease}
.miniCell:hover{transform:translateY(-1px);filter:brightness(1.15)}
.miniHeatLegend{display:flex;align-items:center;gap:8px;margin-top:8px;color:var(--muted);font-size:12px}
.miniHeatLegend .dot{width:12px;height:12px;border-radius:4px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04)}
.miniHeatLegend .dot.l0{background:rgba(255,255,255,.04)}
.miniHeatLegend .dot.l1{background:color-mix(in oklab, var(--accent2) 25%, rgba(255,255,255,.04))}
.miniHeatLegend .dot.l2{background:color-mix(in oklab, var(--accent2) 45%, rgba(255,255,255,.04))}
.miniHeatLegend .dot.l3{background:color-mix(in oklab, var(--accent2) 65%, rgba(255,255,255,.04))}
.miniHeatLegend .dot.l4{background:color-mix(in oklab, var(--accent2) 85%, rgba(255,255,255,.04))}
.miniHeatLegend .label{margin-left:auto;opacity:.85}

/* Habits carousel */
.habitCarousel{position:relative;display:grid;grid-template-columns:1fr;gap:10px;align-items:stretch}
.habitViewport{overflow:hidden;border-radius:18px}
.habitTrack{display:flex;width:100%;transform:translateX(0%)}
.habitSlide{flex:0 0 100%}
.habitDots{display:flex;gap:6px;justify-content:center;align-items:center;margin-top:10px}
.dotBtn{width:8px;height:8px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.05);cursor:pointer;transition:transform .12s ease, filter .12s ease}
.dotBtn:hover{transform:scale(1.15);filter:brightness(1.15)}
.dotBtn.active{background:rgba(124,92,255,.75);border-color:rgba(124,92,255,.92)}

/* Overlay carousel arrows (cleaner than side blocks) */
#habPrev,#habNext{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:38px;
  height:38px;
  padding:0;
  border-radius:14px;
  opacity:.9;
}
#habPrev{left:10px}
#habNext{right:10px}
.habitCarousel:hover #habPrev,
.habitCarousel:hover #habNext{opacity:1}

/* Focus hint card */
.hintCard{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:12px 12px;cursor:pointer;user-select:none}
.hintCard:hover{transform:translateY(-1px);box-shadow:0 16px 40px rgba(0,0,0,.35)}
.hintCard.compact{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:12px;padding:12px 14px}
.hintIcon{width:34px;height:34px;border-radius:14px;display:flex;align-items:center;justify-content:center;background:rgba(124,92,255,.12);border:1px solid rgba(124,92,255,.18)}
.hintText{min-width:0}
.hintTitle{font-weight:800;margin:0 0 2px}
.hintBody{color:var(--text);opacity:.86;font-size:13px;line-height:1.25;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.hintCta{color:rgba(255,255,255,.85);font-size:12px;font-weight:750;letter-spacing:.02em}

/* Streak summary list */
.streakList{display:flex;flex-direction:column;gap:10px;margin-top:6px}
.streakItem{display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto;gap:6px 12px;align-items:center;padding:10px 10px;border-radius:16px;border:1px solid rgba(255,255,255,.07);background:rgba(255,255,255,.02)}
.streakName{font-weight:750;letter-spacing:-.02em;line-height:1.1}
.streakSub{color:var(--muted);font-size:12px;margin-top:2px}
.streakRight{grid-column:2;grid-row:1 / span 2;display:flex;align-items:center}
.streakBar{grid-column:1 / span 1;grid-row:2;height:8px;border-radius:999px;background:rgba(255,255,255,.06);overflow:hidden;border:1px solid rgba(255,255,255,.08)}
.streakFill{height:100%;border-radius:inherit;background:linear-gradient(90deg, rgba(124,92,255,.75), rgba(124,92,255,.35))}

/* Make Insights + Streaks sit nicer */
.insightsGrid{grid-template-columns: 1.1fr .9fr; align-items:start}
@media (max-width: 760px){
  .insightsGrid{grid-template-columns:1fr}
  #habPrev,#habNext{display:none}
}


/* Modern ring (donut) chart */
.ringChart{
  --p: 0;              /* percentage 0-100 */
  --size: 150px;
  --thickness: 18px;
  /* ring status colors (set via JS) */
  --ring-accent: var(--accent);
  --ring-glow: rgba(99,102,241,.20);
  --ring-glow-strong: rgba(99,102,241,.35);
  width: var(--size);
  height: var(--size);
  border-radius: 999px;
  background:
    conic-gradient(var(--ring-accent) calc(var(--p)*1%), rgba(255,255,255,.08) 0);
  position: relative;
  box-shadow:
    0 18px 40px var(--ring-glow),
    inset 0 1px 0 rgba(255,255,255,.10);
  transition: filter .2s ease, transform .2s ease;
}

.ringChart.isAnimating{
  filter: drop-shadow(0 0 18px var(--ring-glow-strong));
}

.ringChart.fullPulse{
  animation: ringPulse 1.6s ease-in-out infinite;
}

@keyframes ringPulse{
  0%, 100%{ transform: translateZ(0) scale(1); filter: drop-shadow(0 0 10px var(--ring-glow-strong)); }
  50%{ transform: translateZ(0) scale(1.02); filter: drop-shadow(0 0 20px var(--ring-glow-strong)); }
}
.ringChart::before{
  content:"";
  position:absolute;
  inset: var(--thickness);
  border-radius: inherit;
  background: linear-gradient(180deg, rgba(2,6,23,.96), rgba(2,6,23,.78));
  border: 1px solid rgba(255,255,255,.08);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
}
.ringInner{
  position:absolute;
  inset: var(--thickness);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:4px;
  text-align:center;
  z-index: 2;
  padding: 10px;
}
.ringBig{
  font-size: 16px;
  font-weight: 800;
  letter-spacing:-.03em;
}
.ringSmall{
  font-size: 12px;
  color: var(--muted);
}
.ringLegend{
  display:flex;
  gap:12px;
  align-items:center;
  flex-wrap:wrap;
  margin-top:12px;
}
.legendDot{
  width:10px;height:10px;border-radius:999px;
  background: var(--accent);
  box-shadow: 0 0 0 3px rgba(99,102,241,.18);
}
.legendDot.muted{ background: rgba(255,255,255,.18); box-shadow:none; }
.legendItem{ display:flex; align-items:center; gap:8px; color: var(--muted); font-size: 12px; }
.legendItem b{ color: var(--text); font-weight: 700; }

/* Typography polish */
.pageTitle{ font-size: 30px; letter-spacing: -.04em; margin:0; }
.subtitle{ color: var(--muted); margin: 6px 0 0; }
.cardTitle{ letter-spacing: -.02em; }

/* Button variants (primary/secondary/ghost) */
.btn{ border-radius: var(--radius-md); }
.btn.secondary{
  background: linear-gradient(180deg, rgba(148,163,184,.22), rgba(148,163,184,.10));
  border: 1px solid rgba(148,163,184,.24);
  color: var(--text);
  box-shadow: 0 12px 30px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.08);
}
.btn.ghost{
  background: rgba(255,255,255,.05);
  border: 1px solid rgba(255,255,255,.10);
  color: var(--text);
  box-shadow: none;
}
.btn.ghost:hover{ filter: brightness(1.1); }



/* --- Habits Analytics upgrades --- */
.analyticsCard{ margin-top: 18px; }
.analyticsControls{ display:flex; gap:10px; align-items:center; justify-content:flex-end; }

/* ===== Habits header (matches Dribbble layout on large screens) ===== */
.habitsHeader{ margin-bottom: 14px; }
.habitsHeaderRow1{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
  flex-wrap:wrap;
}
.habitsRangeSeg{ max-width: 520px; }
.habitsAddBtn{ white-space:nowrap; }

.habitsHeaderRow2{
  margin-top: 10px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
  flex-wrap:wrap;
}
.habitsDateRow{ display:flex; align-items:center; gap: 10px; }

/* Premium period controls (Habits top bar) */
.habitsDateRow .navBtn{
  width: 34px;
  height: 34px;
  padding: 0;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
  box-shadow: 0 10px 26px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  color: rgba(255,255,255,.85);
  font-size: 18px;
  line-height: 1;
}
.habitsDateRow .navBtn:hover{
  background: rgba(255,255,255,.09);
  border-color: rgba(255,255,255,.16);
}
.habitsDateRow .navBtn:active{ transform: translateY(1px); }

.habitsDateRow .rangeLabel{
  padding: 9px 14px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
  box-shadow: 0 10px 26px rgba(0,0,0,.30), inset 0 1px 0 rgba(255,255,255,.06);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  color: rgba(255,255,255,.92);
  font-weight: 800;
  font-size: 13px;
  letter-spacing: .2px;
  white-space: nowrap;
}

/* Make segmented tabs feel more premium without changing layout */
.habitsHeaderRow1 .segBtn{
  background: rgba(255,255,255,.05);
  border-color: rgba(255,255,255,.10);
  box-shadow: 0 10px 24px rgba(0,0,0,.30), inset 0 1px 0 rgba(255,255,255,.06);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
.habitsHeaderRow1 .segBtn.active{
  background: rgba(255,255,255,.10);
  border-color: rgba(255,255,255,.18);
  color: #fff;
}
.habitsHeaderRow1 .segBtn:hover{
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.14);
}


/* Month inline list panel (opens from the list icon in Month view) */
.habitsDateSlot{ flex: 1; min-width: 0; }
.hidden{ display:none !important; }
.monthInline{ display:none; flex:1; min-width:0; background: rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 10px 10px; }
.monthInline.open{ display:flex; flex-direction:column; gap: 10px; }
.monthInlineHeader{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
.monthInlineTitle{ font-weight: 900; letter-spacing: 0.2px; }
.monthInlineBody{ max-height: 280px; overflow:auto; display:flex; flex-direction:column; gap:10px; padding-right: 4px; }
.habitsRightControls{ display:flex; align-items:center; gap: 10px; }
.viewToggles{ display:flex; align-items:center; gap: 8px; }
.viewToggles .tabBtn{ width: 38px; height: 38px; border-radius: 14px; }
.viewToggles .tabBtn[data-settab="grid"] .tabIcon{
  /* Requested: rotate ONLY the grid icon by 90deg (functionality stays the same). */
  display: inline-flex;
  transform: rotate(90deg);
}
.miniBtn{ padding: 8px 12px; border-radius: 14px; }

.overallTrend{
  margin-top: 10px;
  display:grid;
  grid-template-columns: 1fr auto;
  grid-template-rows: auto auto;
  gap: 6px 12px;
  align-items:center;
}
.overallTrend .trendMeta{ grid-column: 1; grid-row: 1; }
.overallTrend .trendAchieved{ grid-column: 2; grid-row: 1; font-size: 12px; color: rgba(255,255,255,0.65); }
.overallTrend .trendAchieved b{ color: rgba(255,255,255,0.92); }
.overallTrend .trendBar{ grid-column: 1 / -1; grid-row: 2; height: 6px; border-radius: 999px; background: rgba(255,255,255,0.10); overflow:hidden; }
.overallTrend .trendFill{ height: 100%; border-radius: 999px; background: rgba(99,102,241,0.9); }
.overallTrend.up .trendFill{ background: rgba(34,197,94,0.95); }
.overallTrend.down .trendFill{ background: rgba(239,68,68,0.95); }
.overallTrend .trendDelta{ font-size: 12px; color: rgba(255,255,255,0.60); }

@media (max-width: 900px){
  .habitsAddBtn{ display:none; }
}

.segRow{
  display:flex;
  gap:12px;
  align-items:stretch;
  justify-content:flex-end;
}

/* Segmented control (Week/Month/Year/All Time)
   User request: remove the outer "pill" container.
   We keep the same markup, but make the container transparent and
   style each segment as its own pill.
*/
.seg{
  position: relative;
  display:flex;
  align-items:stretch;
  gap: 10px;
  width: auto;
  max-width: 100%;
  height: 44px;
  padding: 0;
  border-radius: 0;
  background: transparent;
  border: 0;
  overflow: visible;
  box-shadow: none;
}

/* Sliding active background */
.segIndicator{ display:none; }

.segBtn{
  flex: 1 1 0;
  background: var(--panel);
  border: 1px solid var(--divider);
  color: var(--muted);
  /* Responsive padding so labels never wrap/bleed */
  padding: 0 clamp(4px, 2.2vw, 14px);
  font-weight: 800;
  font-size: clamp(10px, 2.6vw, 13px);
  cursor: pointer;
  position: relative;
  z-index: 1;
  outline: none;
  border-radius: 999px;
  line-height: 1;
  display:flex;
  align-items:center;
  justify-content:center;
  /* Never allow multi-line labels */
  white-space: nowrap !important;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 0; /* critical for flex children to allow truncation */
}

/* Remove global button glossy overlay for segmented control buttons */
.segBtn::after{ content: none !important; }

/* No inner dividers when using separate pills */
.segBtn:not(:last-child)::before{ content:none; }

.segBtn:hover{
  color: var(--text);
}

.segBtn.active{
  color: #fff;
  background: var(--surfaceActive);
}

/* Habit type (Positive / Negative) segmented control accents */
#habitKindSeg .segBtn{
  gap: 8px;
}
#habitKindSeg .segBtn .segIcon{
  flex: 0 0 auto;
  opacity: .95;
  /* Scale with the label size so the + / − stays visible on different UI scales */
  width: 1.15em;
  height: 1.15em;
}
#habitKindSeg .segBtn[data-kind="positive"].active{
  background: rgba(34,197,94,.18);
  color: #22c55e;
  border-color: rgba(34,197,94,.26);
}
#habitKindSeg .segBtn[data-kind="negative"].active{
  background: rgba(239,68,68,.18);
  color: #ef4444;
  border-color: rgba(239,68,68,.26);
}

/* Keep focus accessible without the old purple outline */
.segBtn:focus-visible{
  box-shadow: 0 0 0 2px rgba(106,110,255,.28);
}

/* Inline add habit button next to segmented control */
.addHabitInline{
  white-space: nowrap;
  height: 48px;
  border-radius: 999px;
  padding: 0 18px;
  font-weight: 800;
  letter-spacing: .2px;
  background: var(--accent);
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.10), 0 10px 22px rgba(0,0,0,.20);
  display:flex;
  align-items:center;
}

.addHabitInline:hover{
  filter: brightness(1.05);
}

@media (max-width: 520px){
  .segRow{
    flex-wrap: wrap;
    justify-content:flex-start;
  }
  .seg{
    width: 100%;
  }
  .segBtn{
    flex: 1 1 auto;
    text-align: center;
  }
  .addHabitInline{
    width: 100%;
    text-align: center;
  }
}

/* Extra small phones: keep Month/Year readable and avoid clipping */
@media (max-width: 420px){
  /* Small screens: shrink spacing, keep labels on ONE line */
  .seg{ height: 40px; gap: 8px; }
  .segBtn{
    padding: 0 4px;
    font-size: 11px;
    font-weight: 760;
    white-space: nowrap;
    line-height: 1;
    letter-spacing: 0;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  /* "All Time" needs a touch smaller font to fit */
  .segBtn:last-child{ font-size: 10px; }
  .segBtn:not(:last-child)::before{ content:none; }
}

@media (max-width: 360px){
  /* Even smaller phones */
  .seg{ height: 38px; gap: 6px; }
  .segBtn{
    padding: 0 3px;
    font-size: 10px;
    white-space: nowrap;
    line-height: 1;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .segBtn:last-child{ font-size: 9px; }
}

/* Medium widths: keep the Habits filter header tidy (Year was breaking on low res) */
@media (max-width: 1040px){
  .analyticsControls.analyticsFilter{
    flex-direction: column;
    align-items: stretch;
    gap: 10px;
  }
  .analyticsControls.analyticsFilter .segRow{
    justify-content: flex-start;
    flex-wrap: wrap;
  }
  .rangeNav{
    width: 100%;
    justify-content: space-between;
    gap: 10px;
    flex-wrap: wrap;
  }
  .rangeLabel{
    flex: 1 1 220px;
    text-align: center;
  }
}

/* Habits hero: simple quick-add field (replaces old large "Add & mark" hero card) */
.heroCard.heroAddOnly{
  padding: 14px;
}
.heroAddRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
}
.heroAddForm{
  display:flex;
  align-items:center;
  gap: 10px;
  min-width: 320px;
}
.heroAddInput{
  flex: 1 1 auto;
}
.heroAddBtn{
  height: 42px;
  padding: 0 14px;
  border-radius: 12px;
}
@media (max-width: 700px){
  .heroAddRow{
    flex-direction: column;
    align-items: stretch;
  }
  .heroAddForm{
    min-width: 0;
  }
}
.matrixWrap{ padding: 14px; }
.matrixGrid{ --mgap: 10px; }
.matrixHeaderRow, .matrixRow{ gap: var(--mgap, 10px); }
.matrixCell{touch-action:none; width: var(--cell, 54px); border-radius: 14px; }
.matrixCorner, .matrixHabit, .matrixDate{ border-radius: 14px; }
.matrixHabit{ text-align:center; }
.matrixDate{ min-width: 170px; }
.matrixWrap{ max-height: 720px; }
.matrixHelp{ display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:10px; padding-top:10px; border-top:1px solid rgba(255,255,255,.06); }
.matrixHint{ color: color-mix(in oklab, var(--muted) 85%, rgba(255,255,255,.2)); font-size:.78rem; }
.matrixLegend{ display:flex; gap:10px; align-items:center; }
.legendDot{ width:10px; height:10px; border-radius:999px; background: rgba(255,255,255,.18); border:1px solid rgba(255,255,255,.18); }
.legendDot.done{ background: color-mix(in oklab, var(--accent) 70%, transparent); border-color: rgba(255,255,255,.12); }

/* Habits: swap Grid/List content inside the same analytics card (Dribbble-like) */
.listInGrid{ display:none; margin-top: 12px; }
body.habitsViewList .matrixWrap,
body.habitsViewList .matrixHelp{ display:none; }
body.habitsViewList .listInGrid{ display:block; }


/* Pretty scrollbars */
* {
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,.25) transparent;
}
*::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}
*::-webkit-scrollbar-track {
  background: transparent;
}
*::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, rgba(255,255,255,.35), rgba(255,255,255,.15));
  border-radius: 999px;
  border: 2px solid transparent;
  background-clip: padding-box;
}
*::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.25));
}

.matrixHabit{ position: relative; }
/* Mobile transpose: enable hold-to-delete progress on the sticky habit-name column too */
.matrixHabitName{ position: relative; }

/* Hold-to-delete progress (Habits analytics header) */
.matrixHabit .holdBar,
.matrixHabitName .holdBar{
  position:absolute;
  left:10px;
  right:10px;
  bottom:8px;
  height:4px;
  border-radius:999px;
  background: rgba(255,255,255,.14);
  overflow:hidden;
  opacity:0;
  transition: opacity .12s ease;
}
.matrixHabit .holdBar::after,
.matrixHabitName .holdBar::after{
  content:"";
  display:block;
  height:100%;
  width: calc(var(--hold, 0) * 100%);
  background: color-mix(in oklab, var(--habit-accent) 75%, rgba(255,255,255,.35));
}
.matrixHabit.holding .holdBar,
.matrixHabitName.holding .holdBar{ opacity:1; }

/* --- Bigger Heatmap --- */
.matrixWrap{
  max-height: 70vh;
  padding: 20px;
}
.matrixGrid{
  gap: 14px;
}
.matrixCell{
  width: var(--cell, 54px);
  height: var(--cell, 52px);
  border-radius: 16px;
}
.matrixDate{
  min-width: 200px;
}
.matrixHabit{
  font-size: .85rem;
}

/* --- Heatmap readability tweaks --- */
.matrixHabit{font-size:.9rem; padding:12px 10px; white-space:normal; line-height:1.05;}
/* Allow habit names to wrap (no ellipsis/clamp) */
.matrixHabit span{display:block; white-space:normal; overflow:visible; word-break:break-word;}
.matrixRow.today .matrixDate{border-color: color-mix(in oklab, var(--accent) 35%, rgba(255,255,255,.12)); background: rgba(255,255,255,.05);}
.matrixRow.today .matrixDate .d1{color: var(--text);}
.matrixDate .d1{font-size:1rem;}
.matrixDate .d2{font-size:.78rem;}
.analyticsCard #habitAnalytics, #habitAnalytics{width:100%;}


/* Mini heatmap levels (0-4)
   Each cell sets --heatP (percent of habit accent) */
.miniCell{border-radius:6px;background: color-mix(in oklab, var(--habitAccent) var(--heatP, 8%), rgba(255,255,255,.05));}

.miniCell{border-radius:6px;}
.miniCell.l0{background: rgba(255,255,255,.05)}
.miniCell.l1,.miniCell.l2,.miniCell.l3,.miniCell.l4{background: color-mix(in oklab, var(--habitAccent) 0%, rgba(255,255,255,.05))}

/* ===== Habits responsive layout (desktop + app) ===== */
.habitsAppbar{display:none}
.habitsTabs{display:none}
  #focusHint{margin-bottom: 12px}
.bottomNav{display:none}

/* Tabs/panels: keep only the active panel visible on all screen sizes. */
.tabPanel{display:none}
.tabPanel.active{display:block}

.habitsTopbar{
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap:16px;
  margin-bottom:16px;
}
.habitsTopControls{display:flex;align-items:flex-end;gap:12px;flex-wrap:wrap}
.controlGroup{display:flex;flex-direction:column;gap:6px}
.microLabel{
  font-size: var(--micro-size, 12px);
  color: var(--micro-color, rgba(255,255,255,0.45));
}
.select, .input{
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.10);
  color:#fff;
  border-radius: 12px;
  padding: 10px 12px;
  outline:none;
}
.smallSelect{padding:8px 10px;border-radius:10px}
.iconBtn{
  width:34px;height:34px;border-radius:12px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.05);
  color:#fff;
  font-size:18px;
}

.habitsLayout{
  display:grid;
  grid-template-columns: 1fr 360px;
  gap: 16px;
  align-items:start;
}
.habitsRight{display:block}
.habitsMain{min-width:0}
.habitsRight .card{margin-bottom:12px}

.heroCard .heroTop{display:flex;justify-content:space-between;gap:16px;align-items:center}
.heroKpi{margin-top:6px;font-size: var(--section-size);font-weight: var(--section-weight);color:rgba(255,255,255,0.9)}
.heroNum{font-size: 34px;font-weight: 750;letter-spacing:-0.02em}
.heroDen{opacity:.6;margin-left:4px}
.heroActions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}

/* Smooth progress-ring animation (supported in modern Chromium/WebKit). */
@property --p {
  syntax: '<number>';
  inherits: false;
  initial-value: 0;
}

.ring{
  --p:0;
  width:86px;height:86px;border-radius:50%;
  background: conic-gradient(rgba(99,102,241,0.95) calc(var(--p)*1%), rgba(255,255,255,0.06) 0);
  padding:10px;
  box-shadow: 0 0 0 1px rgba(255,255,255,0.10) inset;
  transition: --p .72s cubic-bezier(.2,.9,.2,1);
}
/* Hero ring inner: scope to .ring to avoid clashing with the global .ringInner used by .ringChart */
.ring .ringInner{
  position: static; /* override earlier .ringInner { position:absolute; inset:... } */
  inset: auto;
  width:100%;height:100%;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  background: rgba(10,12,24,0.85);
  border: 1px solid rgba(255,255,255,0.10);
  font-weight:700;
  color: rgba(255,255,255,0.92);
}

/* Hero uses the segmented Arc Reactor (more modern than a single ring) */
.heroArc{--arc: 86px}
.heroArc::after{opacity: 1}
.heroArc{
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.10) inset,
    0 10px 26px rgba(0,0,0,0.46),
    0 0 22px rgba(99,102,241,0.18);
}

/* ------------------------
   Segmented "Arc Reactor" (Stats → Consistency)
   ------------------------ */
.consistencyViz{display:flex;gap:14px;align-items:center}
.consistencyMeta{flex:1;min-width:0}

.arcReactor{
  --arc: 110px;
  width: var(--arc);
  height: var(--arc);
  border-radius: 50%;
  background-image: conic-gradient(from -90deg, rgba(99,102,241,0.45) 0 30deg, transparent 30deg 60deg);
  position: relative;
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.10) inset,
    0 10px 30px rgba(0,0,0,0.40),
    0 0 18px var(--arc-glow, rgba(99,102,241,0.40));
  overflow: hidden;
}
.arcReactor::before{
  content:"";
  position:absolute; inset: 10px;
  border-radius:50%;
  background:
    radial-gradient(circle at 50% 40%, rgba(255,255,255,0.10), transparent 55%),
    radial-gradient(circle at 50% 60%, rgba(99,102,241,0.10), transparent 60%),
    rgba(10,12,24,0.86);
  border: 1px solid rgba(255,255,255,0.10);
}
.arcReactor::after{
  content:"";
  position:absolute; inset: 0;
  /* tick ring */
  background: radial-gradient(circle, transparent 46%, rgba(255,255,255,0.07) 47%, transparent 52%);
  opacity: .9;
  pointer-events:none;
}

/* Sweeping highlight while the arc animates ("loading" feel) */
.arcReactor.charging::after{
  background:
    conic-gradient(from -90deg,
      transparent 0deg 300deg,
      rgba(255,255,255,0.00) 300deg 320deg,
      rgba(255,255,255,0.18) 320deg 332deg,
      rgba(255,255,255,0.00) 332deg 360deg
    ),
    radial-gradient(circle, transparent 46%, rgba(255,255,255,0.07) 47%, transparent 52%);
  opacity: .95;
  animation: arcSweep 1.05s linear infinite;
  mix-blend-mode: screen;
    z-index: 0;
}
@keyframes arcSweep{
  to{ transform: rotate(360deg); }
}

.arcCore{position:absolute; inset: 18px; border-radius:50%; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:2px; z-index:2}
.arcPct{font-size: 20px; font-weight: 800; letter-spacing:-0.02em; color: var(--arc-on, rgba(255,255,255,0.92)); text-shadow: 0 0 14px var(--arc-on, rgba(99,102,241,0.55))}
.arcLbl{font-size: 12px; color: rgba(255,255,255,0.65); font-weight:600}

/* Charge animation when updated */
.arcReactor.charged{animation: arcCharge .55s ease-out}
@keyframes arcCharge{
  0%{transform: translateY(2px) scale(.98); filter: brightness(.95)}
  55%{transform: translateY(0) scale(1.01); filter: brightness(1.12)}
  100%{transform: translateY(0) scale(1); filter: brightness(1)}
}

/* Pulse when reaching 100% */
.arcReactor.fullPulse{
  animation: arcFullPulse 1.1s ease-in-out infinite;
}
@keyframes arcFullPulse{
  0%{transform: translateY(0) scale(1); filter: brightness(1) drop-shadow(0 0 0 rgba(0,0,0,0))}
  50%{transform: translateY(0) scale(1.03); filter: brightness(1.18) drop-shadow(0 0 18px var(--arc-glow, rgba(99,102,241,0.55)))}
  100%{transform: translateY(0) scale(1); filter: brightness(1) drop-shadow(0 0 0 rgba(0,0,0,0))}
}

@media (max-width: 760px){
  .consistencyViz{gap:12px}
  .arcReactor{--arc: 96px}
  .arcPct{font-size: 18px}
}

.focusCard{padding: 14px 16px}
.focusRow{display:flex;align-items:flex-start;gap:12px}
.focusIcon{width:34px;height:34px;border-radius:12px;display:flex;align-items:center;justify-content:center;background: rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.10)}
.focusTitle{font-size: var(--section-size);font-weight: var(--section-weight);margin-bottom:4px}
.focusBody{font-size: var(--body-size);color: var(--body-color, rgba(255,255,255,0.65));line-height:1.3}
.btn.tertiary{background: rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.12);color: rgba(255,255,255,0.9)}

.habitsAddCard{display:none}
.habitsAddCard.open{display:block}

/* App layout */
@media (max-width: 900px){
  .habitsTopbar{display:none}
  .habitsLayout{grid-template-columns: 1fr}
  .habitsRight{display:none}
  /* Reserve space for the fixed bottom nav so content doesn't sit underneath it */
  .content{padding-bottom: 116px;}

  /* Mobile: keep the weekly table fully inside the card and prevent overflow when there are many habits */
  .matrixWrap{
    overflow: auto;
    overflow-x: hidden;
    max-height: min(620px, calc(100vh - 340px));
    border-radius: 18px;
  }
  /* Remove the lighter sticky-date strip on mobile (it reads like an unwanted band) */
  .matrixWrap::before{opacity: 0; width: 0;}

  .habitsAppbar{
    display:block;
    position: sticky;
    top: 0;
    z-index: 20;
    margin: -28px -16px 14px;
    padding: 14px 16px;
    background: rgba(8,10,20,0.85);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255,255,255,0.08);
  }
  .appbarRow{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .appbarTitle{font-size: 18px;font-weight:700;color:#fff}
  .appbarRight{display:flex;gap:10px;align-items:center}

  .habitsTabs{
    display:flex;
    gap:8px;
    margin: 8px 0 14px;
  }
  .tabBtn{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:0;
    flex:0;
    width: 44px;
    height: 38px;
    padding: 0;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(255,255,255,0.04);
    color: rgba(255,255,255,0.75);
    font-weight: 650;
  }
  .tabBtn.active{
    color:#fff;
    background: rgba(99,102,241,0.18);
    border-color: rgba(99,102,241,0.35);
  }

  .tabIcon{display:inline-flex;align-items:center;justify-content:center;}
  .tabIcon svg{width:1.15em;height:1.15em;opacity:0.9;}
  .tabBtn.active .tabIcon svg{opacity:1;}
  .tabText{line-height:1;}

  /* Mobile weekly list (Dribbble-style): circles instead of square cells */
  .matrixWrap{overflow: auto; overflow-x:hidden;}
  .matrixGrid.mobileWeekTable{
    display:flex;
    flex-direction:column;
    gap: 10px;
    padding: 12px;
  }
  .matrixGrid.mobileWeekTable{ --mwt-dot: clamp(18px, 5.2vw, 26px); }
  .mwtHead{
    padding: 0 12px;
  }
  .mwtDowRow{
    display:grid;
    grid-template-columns: repeat(7, var(--mwt-dot)) 44px;
    align-items:center;
    column-gap: 10px;
    justify-content:start;
  }
  .mwtRow{
    display:flex;
    flex-direction:column;
    gap: 8px;
  }
  .mwtCells{
    display:grid;
    grid-template-columns: repeat(7, var(--mwt-dot)) 44px;
    align-items:center;
    column-gap: 10px;
    justify-content:start;
    padding-left: 10px; /* align under label content */
  }
  .mwtCorner{height: 1px;} /* spacer */
  .mwtDow{
    font-size: 11px;
    font-weight: 750;
    color: rgba(255,255,255,0.55);
    text-align:center;
    letter-spacing: .08em;
  }
  .mwtLabel{
    display:flex;
    align-items:center;
    gap: 10px;
    min-width:0;
    padding: 8px 10px;
    border-radius: 14px;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.06);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
  }
  .mwtDot{
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--habit-accent, rgba(99,102,241,0.9));
    box-shadow: 0 0 0 4px color-mix(in oklab, var(--habit-accent, rgba(99,102,241,0.8)) 18%, transparent);
    flex:0 0 auto;
  }
  .mwtName{
    font-size: 13px;
    font-weight: 700;
    color: rgba(255,255,255,0.9);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .mwtCell{
    width: var(--mwt-dot);
    height: var(--mwt-dot);
    border-radius: 999px !important;
    justify-self:center;
  }
  .mwtFrac{
    font-size: 12px;
    font-weight: 750;
    color: rgba(255,255,255,0.62);
    text-align:right;
  }
  .mwtFracHead{opacity:0;}

  /* Make the dot cells feel like "soft circles" */
  .matrixGrid.mobileWeekTable .matrixCell{
    border-radius: 999px !important;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
  }
  .matrixGrid.mobileWeekTable .matrixCell.done{
    background: color-mix(in oklab, var(--habit-accent) 65%, transparent);
    border-color: color-mix(in oklab, var(--habit-accent) 28%, rgba(255,255,255,.07));
    box-shadow: 0 0 0 6px color-mix(in oklab, var(--habit-accent) 12%, transparent);
  }
  .matrixGrid.mobileWeekTable .matrixCell.missed{
    background: rgba(255,255,255,0.02);
    border-color: rgba(255,255,255,0.06);
    opacity: 0.75;
  }

  /* Hero action pills (Today / Add habit) — visually aligned with tabs but not identical. */
  .heroPill{
    padding: 10px 14px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(255,255,255,0.04);
    color: rgba(255,255,255,0.82);
    font-weight: 650;
    letter-spacing: -.01em;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.08);
    transition: transform .12s ease, background .12s ease, border-color .12s ease, filter .12s ease;
  }
  .heroPill::after{opacity:0} /* disable glossy overlay from global button style */
  .heroPill:hover{
    background: rgba(99,102,241,0.10);
    border-color: rgba(99,102,241,0.22);
  }
  .heroPill:active{transform: translateY(1px)}
  .heroPill:focus-visible{
    outline: none;
    box-shadow: 0 0 0 3px rgba(99,102,241,0.22), inset 0 1px 0 rgba(255,255,255,0.08);
  }

  /* Add-habit click animation */
  @keyframes pillPop{
    0%{transform: scale(1)}
    45%{transform: scale(0.96)}
    100%{transform: scale(1)}
  }
  .heroPill.pillPop{animation: pillPop .18s ease-out}

  /* Mobile add-habit modal */
  .modal{display:none}
  .modal.open{display:block}
  .modalBackdrop{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.48);
    backdrop-filter: blur(4px);
    z-index: 200;
  }
  .modalSheet{
    position: fixed;
    left: 12px;
    right: 12px;
    bottom: 12px;
    z-index: 201;
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(16,18,32,0.92);
    box-shadow: 0 24px 70px rgba(0,0,0,0.55);
    padding: 14px;
    transform: translateY(16px);
    opacity: 0;
  }
  .modal.open .modalSheet{
    animation: sheetUp .18s ease-out forwards;
  }
  @keyframes sheetUp{
    from{transform: translateY(16px); opacity:0}
    to{transform: translateY(0); opacity:1}
  }
  .modalHeader{
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin-bottom: 10px;
  }
  .modalTitle{font-weight: 750; letter-spacing: -.01em}
  .iconBtn{
    width: 36px;
    height: 36px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(255,255,255,0.04);
    color: rgba(255,255,255,0.9);
    display:inline-flex;
    align-items:center;
    justify-content:center;
  }
  .iconBtn::after{opacity:0}
  .iconBtn:active{transform: translateY(1px)}
  .modalBody{display:flex; flex-direction:column; gap:8px}
  .modalActions{display:flex; gap:10px; justify-content:flex-end; margin-top: 12px}
  .modalActions .btn{min-width: 92px}

  @keyframes shake{
    0%,100%{transform: translateX(0)}
    20%{transform: translateX(-4px)}
    40%{transform: translateX(4px)}
    60%{transform: translateX(-3px)}
    80%{transform: translateX(3px)}
  }
  .modalInput.shake{animation: shake .24s ease-in-out}

  /* prevent background scroll when modal is open */
  .modalOpen{overflow:hidden}

  .tabPanel{display:none}
  .tabPanel.active{display:block}

  .habitsAddCard{display:none}
  .habitsAddCard.open{display:block}

  .bottomNav{
    display:flex;
    position: fixed;
    left:0; right:0; bottom:0;
    height: 64px;
    background: rgba(8,10,20,0.96);
    border-top: 1px solid rgba(255,255,255,0.08);
    z-index: 50;
  }
  .bottomNav a{
    flex:1;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:4px;
    color: rgba(255,255,255,0.65);
    text-decoration:none;
    font-size: 12px;
    position: relative;
  }
  .bottomNav a span{font-size: 10.5px; opacity:.85}
  .bottomNav a.active{color:#fff}

  /* Active indicator (bottom nav): 14px underline */
  .bottomNav a.active::after{
    content:"";
    position:absolute;
    left:50%;
    transform: translateX(-50%);
    bottom: 6px;
    width: 14px;
    height: 2px;
    border-radius: 2px;
    background: var(--accent);
  }
}

/* Floating New Habit button (Dribbble-inspired) */
.fabNewHabit{
  position: fixed;
  right: 24px;
  bottom: 92px; /* clears bottom nav */
  height: 56px;
  width: 56px;
  padding: 0;
  border: none;
  border-radius: 999px;
  background: #6A6EFF;
  color: #FFFFFF;
  display: inline-flex;
  align-items: center;
  justify-content: flex-start;
  gap: 10px;
  cursor: pointer;
  z-index: 50;
  box-shadow: 0 10px 28px rgba(0,0,0,0.35);
  transition: width 220ms ease, transform 120ms ease, box-shadow 220ms ease, filter 220ms ease;
  animation: fabIntro 420ms ease both;
  overflow: hidden; /* keeps icon centered when collapsed */
}

/* Left circular area so + stays perfectly centered */
.fabNewHabit .fabCircle{
  width: 56px;
  height: 56px;
  display: grid;
  place-items: center;
  flex: 0 0 56px;
}

/* Crisp, longer-stroke plus built from bars (not a glyph) */
.fabNewHabit .fabPlus{
  width: 24px;
  height: 24px;
  position: relative;
  transform: rotate(0deg);
  transition: transform 220ms ease;
}
.fabNewHabit .fabPlus::before,
.fabNewHabit .fabPlus::after{
  content: "";
  position: absolute;
  left: 50%;
  top: 50%;
  width: 24px;
  height: 3px;
  background: #FFFFFF;
  border-radius: 2px;
  transform: translate(-50%, -50%);
}
.fabNewHabit .fabPlus::after{
  transform: translate(-50%, -50%) rotate(90deg);
}
.fabNewHabit .fabText{
  font-weight: 700;
  letter-spacing: .2px;
  white-space: nowrap;
  opacity: 0;
  max-width: 0;
  overflow: hidden;
  transform: translateX(-6px);
  transition: opacity 160ms ease, transform 220ms ease, max-width 220ms ease;
}

/* Expand on hover/focus to show label (matches Dribbble behavior) */
.fabNewHabit:hover,
.fabNewHabit:focus-visible{
  width: 170px;
  filter: brightness(1.03);
}
.fabNewHabit:hover .fabText,
.fabNewHabit:focus-visible .fabText{
  opacity: 1;
  max-width: 140px;
  transform: translateX(0);
}
.fabNewHabit:hover .fabPlus,
.fabNewHabit:focus-visible .fabPlus{
  transform: rotate(22deg); /* light rotation, like the reference */
}

.fabNewHabit:active{
  transform: translateY(1px) scale(0.98);
  box-shadow: 0 8px 18px rgba(0,0,0,0.30);
}

@keyframes fabIntro{
  from{ opacity: 0; transform: translateY(14px) scale(0.98); }
  to{ opacity: 1; transform: translateY(0) scale(1); }
}

@media (min-width: 901px){
  .fabNewHabit{ bottom: 28px; }
}

@media (prefers-reduced-motion: reduce){
  .fabNewHabit{ animation: none; transition: none; }
  .fabNewHabit .fabIcon,
  .fabNewHabit .fabText{ transition: none; }
}

@media (max-width: 900px){ .sidebar{display:none} }

/* Desktop: keep the analytics grid + list/table switcher; hide the legacy stats panel
   because insights/streaks are duplicated into the right side panel. */
@media (min-width: 901px){
  .tabPanel[data-panel="stats"]{display:none}
  .habitsTabs{display:flex}
  .habitsTabs{gap:8px;margin: 8px 0 14px;}
  .tabBtn{
    display:flex;
    align-items:center;
    justify-content:center;
    width: 44px;
    height: 38px;
    padding: 0;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(255,255,255,0.04);
    color: rgba(255,255,255,0.75);
    font-weight: 650;
    cursor: pointer;
  }
  .tabBtn.active{
    color:#fff;
    background: rgba(99,102,241,0.18);
    border-color: rgba(99,102,241,0.35);
  }
  .tabIcon{display:inline-flex;align-items:center;justify-content:center;}
  .tabIcon svg{width:1.15em;height:1.15em;opacity:0.9;}
  .tabBtn.active .tabIcon svg{opacity:1;}
}


/* Habits: List tab stacked layout */
.habitListStack{
  display:flex;
  flex-direction:column;
  gap:14px;
}
.habitListStack .card{
  width:100%;
}

/* Utility: show only on phone */
.onlyMobile{display:none;}
@media (max-width:900px){
  .onlyMobile{display:inline-flex;}
}


/* Override generic .grid in List tab container */
[data-panel="list"] #habitList.grid{display:block;}

@media (max-width:900px){
  .matrixHeaderRow{padding: 10px 0 12px;}
}

/* --- LifeSync branding images --- */
.logoMark{
  width: 34px;
  height: 34px;
  border-radius: 10px;
  display:block;
}
.pageTitleRow{
  display:flex;
  align-items:center;
  gap:10px;
}
.topbarLogo{
  width: 22px;
  height: 22px;
  border-radius: 7px;
  flex: 0 0 auto;
  opacity: .95;
}

/* --- LifeSync branding images (v2 responsive) --- */
.logoMark{
  width: clamp(36px, 3.2vw, 48px);
  height: clamp(36px, 3.2vw, 48px);
  border-radius: 12px;
  display:block;
}
.topbarLogo{
  width: clamp(22px, 2.2vw, 30px);
  height: clamp(22px, 2.2vw, 30px);
  border-radius: 9px;
  flex: 0 0 auto;
  opacity: .95;
}
.pageTitleRow{
  display:flex;
  align-items:center;
  gap:12px;
}

/* Keep dashboard topbar layout stable */
.topbar > div:first-child{
  min-width: 0;
}

/* --- LifeSync branding images (v3 visibility) --- */
.brand{
  gap: 14px;
}
.logoMark{
  width: clamp(44px, 3.2vw, 56px);
  height: clamp(44px, 3.2vw, 56px);
  border-radius: 14px;
}
.topbarLogo{
  width: clamp(26px, 2.2vw, 34px);
  height: clamp(26px, 2.2vw, 34px);
  border-radius: 10px;
}

/* v4: ensure modals don't dim the whole desktop unless opened */
.modalBackdrop{display:none;}
.modalBackdrop.show{display:flex;}

/* v4: bigger, clearer brand mark */
.logoMark{
  width: clamp(60px, 4vw, 78px);
  height: clamp(60px, 4vw, 78px);
  border-radius: 18px;
}
.brand{
  padding: 14px 14px;
}
.brandTitle{ font-size: 16px; }
.brandSub{ font-size: 12px; opacity:.8; }

/* ===== v5 HUGE ICON VISIBILITY FIX ===== */

/* Sidebar brand block */
.brand{
  padding: 18px 16px;
  gap: 18px;
}
.logoMark{
  width: clamp(84px, 6vw, 110px);
  height: clamp(84px, 6vw, 110px);
  border-radius: 22px;
}

/* Sidebar nav icons */
.sidebar .navIcon{
  width: clamp(20px, 2.8vw, 30px);
  height: clamp(20px, 2.8vw, 30px);
  display:inline-block;
  object-fit: contain;
  vertical-align: -3px;
  margin-right: 8px;

  image-rendering: -webkit-optimize-contrast;
  filter: contrast(1.28) brightness(1.16) saturate(1.22);
}

/* Toolbar / header icons */
.topbarLogo{
  width: clamp(40px, 3.5vw, 56px);
  height: clamp(40px, 3.5vw, 56px);
  border-radius: 14px;
}

/* Buttons like Open in app */
.btnIcon,
.openInAppIcon{
  width: 28px;
  height: 28px;
  font-size: 20px;
}

/* Welcome / hero icons */
.heroIcon,
.sectionIcon{
  width: 48px;
  height: 48px;
  font-size: 34px;
}

/* Cards icons */
.cardIcon{
  width: 44px;
  height: 44px;
  font-size: 30px;
}

/* ===== v6: BRAND TEXT + HUGE ICONS ===== */
.brandTitle{
  font-size: 24px !important;
  font-weight: 900 !important;
  letter-spacing: .2px;
  color: #f3f6ff !important;
  text-shadow: 0 2px 10px rgba(0,0,0,.45);
}
.brandSub{
  font-size: 14px !important;
  color: rgba(243,246,255,.82) !important;
}
.logoMark{
  width: clamp(132px, 8vw, 176px) !important;
  height: clamp(132px, 8vw, 176px) !important;
  border-radius: 28px !important;
}
.topbarLogo{
  width: clamp(64px, 4vw, 92px) !important;
  height: clamp(64px, 4vw, 92px) !important;
  border-radius: 20px !important;
}
.pageTitleRow{ gap: 18px !important; }

/* ===== v7: Brand card layout fix (desktop) ===== */
@media (min-width: 900px){
  /* Top-left brand card container */
  .brand, .brandCard, .brandBox, .brandPanel{
    display:flex !important;
    align-items:center !important;
    gap: 18px !important;
    padding: 22px !important;
    min-height: 180px !important;
    height: auto !important;
    overflow: visible !important;
  }

  /* Ensure children don't get squished */
  .brand > *, .brandCard > *, .brandBox > *, .brandPanel > *{
    min-width: 0;
  }

  /* Logo */
  .logoMark{
    width: clamp(150px, 9vw, 190px) !important;
    height: clamp(150px, 9vw, 190px) !important;
    flex: 0 0 auto !important;
  }

  /* Text area */
  .brandText, .brandInfo{
    display:flex !important;
    flex-direction:column !important;
    justify-content:center !important;
    gap: 6px !important;
  }

  .brandTitle{
    font-size: 28px !important;
    font-weight: 900 !important;
    line-height: 1.05 !important;
    color: #f3f6ff !important;
    white-space: nowrap !important;
  }

  .brandSub{
    font-size: 15px !important;
    opacity: .86 !important;
    white-space: nowrap !important;
  }
}

/* ===== v8: COMPLETE brand block fix (desktop) ===== */
@media (min-width: 900px){
  /* Make sidebar a bit wider so icons and labels breathe */
  .sidebar{
    width: 300px !important;
  }

  /* Brand card becomes vertical (prevents overlap) */
  .brand, .brandCard, .brandBox, .brandPanel{
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    text-align: center !important;
    gap: 12px !important;
    padding: 20px 18px !important;
    min-height: 260px !important;
  }

  .logoMark{
    width: 180px !important;
    height: 180px !important;
    border-radius: 22px !important;
  }

  .brandText, .brandInfo{
    align-items: center !important;
  }

  .brandTitle{
    font-size: 30px !important;
    font-weight: 900 !important;
    line-height: 1.05 !important;
    margin: 0 !important;
    white-space: nowrap !important;
  }

  .brandSub{
    font-size: 14px !important;
    opacity: .85 !important;
    margin: 0 !important;
    white-space: nowrap !important;
  }
}

/* ===== v10: Fix day header chips (avoid cutting numbers) ===== */
.matrixDayHead{
  overflow: visible !important;
  min-width: 44px;
  padding: 6px 6px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  line-height: 1.05;
}
.matrixDayHead .d1,
.matrixDayHead .d2{
  display:flex;
  align-items:center;
  justify-content:center;
  width:100%;
}
.matrixDayHead .m{
  font-size: 12px;
  letter-spacing: .2px;
  opacity: .9;
}
.matrixDayHead .n{
  font-size: 13px;
  font-weight: 800;
  line-height: 1.05;
  padding-bottom: 1px; /* prevents bottom clip on some renderers */
}

/* On very small widths, give chips a bit more room */
@media (max-width: 420px){
  .matrixDayHead{ min-width: 46px; padding: 7px 6px; }
  .matrixDayHead .n{ font-size: 14px; }
}

/* ===== v11: In-app TAB icon fix ===== */
.tabIcon, .tab img, .tabIcon img{
  width: 22px !important;
  height: 22px !important;
  min-width: 22px;
  min-height: 22px;
}

.tabIcon img, .tab img{
  object-fit: contain;
}

/* ===== v12: Habits wheel redesign (keep logic) ===== */
.habitWheel{
  width: clamp(120px, 16vw, 190px);
  height: clamp(120px, 16vw, 190px);
  position: relative;
  display: grid;
  place-items: center;
  overflow: visible;
}
.wheelSvg{
  width: 100%;
  height: 100%;
  overflow: visible;
}
.wheelRot{
  transform: rotate(-90deg);
  transform-origin: 60px 60px;
}
.wheelTrack{
  fill: none;
  stroke: rgba(255,255,255,0.09);
  stroke-width: 7;
  stroke-linecap: round;
}
.wheelProg{
  fill: none;
  stroke: url(#wheelGrad);
  stroke-width: 7;
  stroke-linecap: round;
  filter:
    drop-shadow(0 0 10px var(--wheel-glow-strong, var(--wheel-glow, rgba(255, 204, 64, 0.30))))
    drop-shadow(0 0 22px var(--wheel-glow, rgba(255, 204, 64, 0.22)));
  /* rAF animation controls fill; avoid CSS transition fighting it */
}

/* animation helpers (status glow + pulse) */
.habitWheel.isAnimating{
  /* Avoid boxy glow around the whole square bounds; keep glow on the ring only */
  filter: none;
}
.habitWheel.isAnimating .wheelProg{
  filter:
    drop-shadow(0 0 14px var(--wheel-glow-strong, var(--wheel-glow, rgba(255, 204, 64, 0.34))))
    drop-shadow(0 0 30px var(--wheel-glow, rgba(255, 204, 64, 0.26)));
}
.habitWheel.fullPulse{
  animation: wheelPulse 1.6s ease-in-out infinite;
}
@keyframes wheelPulse{
  0%,100%{ transform: scale(1); }
  50%{ transform: scale(1.02); }
}
.wheelCenter{
  position:absolute;
  inset: 0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap: 6px;
  text-align:center;
}
.wheelPct{
  /* user request: smaller, centered % */
  font-size: clamp(18px, 2.8vw, 30px);
  font-weight: 900;
  letter-spacing: .2px;
  color: rgba(255, 222, 107, 0.98);
  text-shadow: 0 10px 30px rgba(255, 204, 64, 0.18);
}
.wheelSub{
  /* Scale down on small screens so it doesn't crowd the center */
  font-size: clamp(11px, 1.9vw, 14px);
  line-height: 1.15;
  color: rgba(230, 234, 248, 0.65);
}

@media (max-width: 420px){
  .wheelSub{ font-size: 11px; }
}


/* responsive hide habitsAddCard */
@media (max-width: 780px){
  .habitsAddCard{ display:none !important; }
}

/* Habits icon (replaces 🔥) */
.navIcon{
  width: clamp(20px, 2.8vw, 30px);
  height: clamp(20px, 2.8vw, 30px);
  object-fit: contain;
  vertical-align: -3px;
  margin-right: 8px;
}
.navIconBottom{
  width: clamp(18px, 2.6vw, 26px);
  height: clamp(18px, 2.6vw, 26px);
  object-fit: contain;
  vertical-align: -3px;
  margin-right: 6px;

  image-rendering: -webkit-optimize-contrast;
  filter: contrast(1.20) brightness(1.12) saturate(1.18);
}
@media (max-width: 520px){
  .navIcon{ width: 18px; height: 18px; margin-right: 6px; }
  .navIconBottom{ width: 16px; height: 16px; margin-right: 5px; }
}


.bottomNav .navIcon{
  width: clamp(20px, 2.8vw, 30px);
  height: clamp(20px, 2.8vw, 30px);
  margin-right: 0;
  vertical-align: 0;
}

/* Active state: keep icons stable (no glow effects) */
.nav a.active .navIcon,
.bottomNav a.active .navIcon{ filter: none; }

/* One-time micro interaction on tab open (triggered from app.js) */
img.pulseOnce{
  animation: navPulseOnce .14s ease-out 1;
}
@keyframes navPulseOnce{
  0%{ transform: scale(1); }
  40%{ transform: scale(.96); }
  100%{ transform: scale(1.08); }
}

/* ---------------- Plan Workout: multiple workouts per day ---------------- */
.pwWrap{ max-width: 880px; margin: 0 auto; padding-bottom: calc(24px + var(--kb, 0px)); }

.pwHeader{
  background: rgba(255,255,255,.04);
  border: 1px solid rgba(148,163,184,.18);
  border-radius: 20px;
  padding: 16px 16px 14px;
  box-shadow: 0 18px 50px rgba(0,0,0,.35);
}

.pwHeaderTop{ display:flex; align-items:center; justify-content:space-between; gap: 10px; margin-bottom: 10px; }
.pwBackInline{ padding: 9px 12px; border-radius: 14px; font-weight: 800; }

.pwSaved{ font-size: 12px; color: rgba(255,255,255,.70); }

.pwDate{
  font-size: 30px;
  line-height: 1.1;
  font-weight: 800;
  letter-spacing: -0.02em;
  color: rgba(255,255,255,.96);
}

.pwNameRow{ margin-top: 12px; }
.pwNameInput{
  width: 100%;
  font-size: 22px;
  font-weight: 800;
  letter-spacing: -0.02em;
  border-radius: 18px;
  padding: 14px 14px;
}

.pwSubRow{ display:flex; flex-wrap:wrap; gap: 12px; margin-top: 12px; }
.pwSubItem{
  display:flex;
  align-items:center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 16px;
  border: 1px solid rgba(148,163,184,.16);
  background: rgba(2,6,23,.35);
}
.pwMetaLabel{ font-size: 12px; font-weight: 700; color: rgba(255,255,255,.68); }
.pwSelect{ min-width: 160px; padding: 10px 12px; border-radius: 14px; }

.btn.small{ padding: 9px 11px; border-radius: 14px; font-size: 13px; }

.pwPrimaryAdd{
  width: 100%;
  margin: 14px 0 10px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 10px;
  padding: 14px 14px;
  border-radius: 18px;
}
.pwPlus{ font-size: 20px; font-weight: 900; }
.pwAddLabel{ font-weight: 900; }

.pwExercises{ display:flex; flex-direction:column; gap: 12px; margin-top: 10px; }

.pwEmpty{
  border: 1px dashed rgba(148,163,184,.28);
  border-radius: 20px;
  padding: 18px;
  text-align:center;
  background: rgba(255,255,255,.02);
}
.pwEmptyText{ font-weight: 800; font-size: 16px; }
.pwEmptySub{ margin-top: 6px; opacity:.75; font-size: 13px; }
.pwAddTile{ margin-top: 12px; }
.pwAddTile.big{ width: 100%; justify-content:center; }

/* Exercise card */
.exCard{
  background: rgba(255,255,255,.04);
  border: 1px solid rgba(148,163,184,.18);
  border-radius: 20px;
  padding: 14px;
  box-shadow: 0 16px 44px rgba(0,0,0,.35);
}
.exCard.dragOver{ outline: 2px solid rgba(99,102,241,.35); }

.exHead{ display:flex; align-items:center; gap: 10px; }
.exDrag{ cursor: grab; user-select:none; opacity:.75; }
.exTitle{ flex: 1; font-weight: 900; letter-spacing: -0.01em; }

.exMenuBtn{
  width: 44px;
  height: 44px;
  border-radius: 999px;
  padding: 0;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size: 20px;
  letter-spacing: -0.02em;
  background: rgba(255,255,255,.055);
  border: 1px solid rgba(148,163,184,.18);
  color: rgba(255,255,255,.94);
  box-shadow: 0 10px 22px rgba(0,0,0,.25);
}
.exMenuBtn:hover{ background: rgba(255,255,255,.085); border-color: rgba(148,163,184,.26); }
.exMenuBtn:active{ transform: scale(.97); }
.exMenuBtn:focus-visible{ outline: 2px solid rgba(99,102,241,.55); outline-offset: 2px; }

.exSets{ margin-top: 10px; display:flex; flex-direction:column; gap: 8px; }
.setRow{ display:grid; grid-template-columns: 20px 26px 1fr 1fr 1fr; gap: 8px; align-items:center; }
.setNum{ font-size: 12px; opacity:.75; text-align:center; }
.setInput{ width: 100%; padding: 10px 10px; border-radius: 14px; }

.exActions{ display:flex; gap: 10px; margin-top: 10px; flex-wrap:wrap; }
.chipBtn{
  background: rgba(255,255,255,.055);
  border: 1px solid rgba(148,163,184,.18);
  color: rgba(255,255,255,.92);
  border-radius: 999px;
  padding: 10px 12px;
  box-shadow: none;
}
.chipBtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.08); }

.exNotes{ margin-top: 10px; }
.exNotes textarea{ width: 100%; min-height: 72px; resize: vertical; }

/* Exercise menu popover */
.exMenuPopover{
  position: fixed;
  z-index: 1002;
  min-width: 180px;
  border-radius: 16px;
  background: rgba(2,6,23,.90);
  border: 1px solid rgba(148,163,184,.22);
  box-shadow: 0 22px 60px rgba(0,0,0,.55);
  padding: 8px;
  backdrop-filter: blur(16px);
}
.exMenuItem{
  width: 100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid transparent;
  background: transparent;
  color: rgba(255,255,255,.92);
  box-shadow: none;
}
.exMenuItem:hover{ background: rgba(255,255,255,.06); border-color: rgba(148,163,184,.16); transform:none; }
.exMenuDanger{ color: rgba(239,68,68,.95); }

/* Bottom sheet / modal */
.sheetOverlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(6px);
  z-index: 1000;
}
.sheet{
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: 18px;
  width: min(720px, calc(100vw - 18px));
  max-height: min(78vh, calc(100vh - 110px));
  overflow: hidden;
  z-index: 1001;
  border-radius: 22px;
  background: rgba(2,6,23,.92);
  border: 1px solid rgba(148,163,184,.22);
  box-shadow: 0 30px 80px rgba(0,0,0,.65);
  backdrop-filter: blur(18px);
}
.sheetTop{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding: 14px 14px 10px; }
.sheetTitle{ font-weight: 900; letter-spacing: -0.01em; }
.sheetClose{ width: 42px; height: 38px; border-radius: 14px; padding:0; box-shadow:none; background: rgba(255,255,255,.06); border: 1px solid rgba(148,163,184,.20); }

.sheetSearch{ padding: 0 14px 12px; }
.sheetSearch input{ width: 100%; border-radius: 16px; }

.sheetHint{
  padding: 0 14px 10px;
  font-size: 12px;
  opacity: .70;
}

.sheetChips{ display:flex; gap: 8px; padding: 0 14px 10px; overflow:auto; -webkit-overflow-scrolling: touch; }
.sheetChip{
  white-space: nowrap;
  background: rgba(255,255,255,.055);
  border: 1px solid rgba(148,163,184,.18);
  color: rgba(255,255,255,.92);
  border-radius: 999px;
  padding: 9px 12px;
  box-shadow:none;
}
.sheetChip.active{ background: rgba(99,102,241,.22); border-color: rgba(99,102,241,.40); }
.sheetChip:hover{ transform:none; background: rgba(255,255,255,.08); }

.sheetList{ overflow:auto; max-height: calc(min(74vh, 100vh - 120px) - 150px); padding: 0 8px 10px; }

/* Slightly bigger tap targets & clearer separation */
.sheetList .exRow{ margin: 2px 0; }

.exRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
  padding: 12px 12px;
  border-radius: 16px;
  border: 1px solid transparent;
  cursor: pointer;
}
.exRow:hover{ background: rgba(255,255,255,.05); border-color: rgba(148,163,184,.14); }
.exRowMain{ display:flex; flex-direction:column; gap: 3px; }
.exRowTitle{ font-weight: 900; }
.exRowMeta{ font-size: 12px; opacity: .45; }

/* "Create custom exercise" row */
.exRowCreate{
  border-color: rgba(99,102,241,.28);
  background: rgba(99,102,241,.10);
}
.exRowCreate:hover{
  background: rgba(99,102,241,.14);
  border-color: rgba(99,102,241,.40);
}
.exCreatePlus{
  width: 42px;
  height: 38px;
  border-radius: 14px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight: 900;
  background: rgba(99,102,241,.22);
  border: 1px solid rgba(99,102,241,.40);
}

.exStar{
  width: 42px;
  height: 38px;
  border-radius: 14px;
  padding:0;
  box-shadow:none;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(148,163,184,.18);
}
.exStar.on{ border-color: rgba(250,204,21,.45); }

@media (max-width: 520px){
  .pwHeader{ padding: 14px; }
  .pwSelect{ min-width: 140px; }
  .sheet{ left: 0; transform: none; width: 100vw; bottom: 0; border-radius: 22px 22px 0 0; }
}

.pwWorkoutPicker{
  display:flex;
  align-items:center;
  gap:10px;
  margin-top:10px;
}

.pwIconBtn{
  width:34px;
  height:34px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  color: rgba(255,255,255,.92);
  font-size:18px;
  line-height: 1;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  user-select:none;
  transition: transform .08s ease, background .15s ease, border-color .15s ease;
}

.pwIconBtn:active{ transform: scale(.96); }
.pwIconBtn:hover{ background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.22); }



/* Wide-screen enhancement (desktop only): use more horizontal space for readability */
@media (min-width: 1400px){
  /* Larger navigation + content breathing room on big screens */
  .layout{ grid-template-columns: 320px 1fr; }
  .sidebar{ padding: 26px 20px; }
  .nav{ gap: 8px; }
  .nav a{ padding: 14px 14px; font-size: 15px; border-radius: 16px; }
  .nav a .iconWrap{ width: 24px; height: 24px; }
.content{
    max-width: 1680px;
    padding: 38px 52px 70px;
  }
  /* Make the habits matrix cells bigger on large screens */
  .matrixGrid{ --cell: 64px; --dateCol: 220px; }
  .analyticsTop{ grid-template-columns: 1.15fr .9fr; }
}


/* Force hide top workout bar */
.topbar{display:none!important;}


/* Hide legacy Today's workout panel (v3 uses its own header) */
#todayWorkoutCard{display:none !important;}


/* REMOVE Today's workout from Dashboard COMPLETELY */
.todayWorkout, #todayWorkout, .dashWorkout, .dashHero, .workoutCard { display:none !important; }

/* --- Habits: Apple-style range filter (dark) --- */
.analyticsControls.analyticsFilter{
  flex-direction: column;
  align-items: flex-end;
  gap: 10px;
}
.seg.segWide .segBtn{
  padding: 0 14px;
  font-size: .82rem;
}
.rangeNav{
  display:flex;
  align-items:center;
  gap:10px;
}
.rangeNav .navBtn{
  width: 38px;
  height: 34px;
  padding: 0;
  border-radius: 12px;
  background: var(--panel);
  border: 1px solid var(--divider);
  color: var(--muted2);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
}
.rangeNav .navBtn.disabled{opacity:.45;pointer-events:none}
.rangeLabel{
  padding: 8px 12px;
  border-radius: 999px;
  background: var(--panel);
  border: 1px solid var(--divider);
  color: var(--text);
  font-weight: 750;
  font-size: .86rem;
  letter-spacing: .2px;
  white-space: nowrap;
}

@media (max-width: 520px){
  .analyticsControls.analyticsFilter{
    align-items: stretch;
    width: 100%;
  }
  .analyticsControls.analyticsFilter .seg{ align-self: center; }
  .rangeNav{ justify-content: space-between; }
  .rangeLabel{ flex: 1; text-align: center; }
}


/* --- Habits Quick Mark panel (Dribbble-inspired) --- */

#habitQuickMark .qmHead{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px}
#habitQuickMark .qmTitle{font-weight:700;font-size:14px;letter-spacing:.2px}
#habitQuickMark .qmSub{font-size:12px;opacity:.7;margin-top:2px}
#habitQuickMark .qmList{display:flex;flex-direction:column;gap:8px}
#habitQuickMark .qmRow{display:flex;align-items:center;gap:10px;padding:12px;border-radius:16px;
  /* tint the whole row with the habit color (very subtle) */
  background:color-mix(in srgb, var(--accent) 12%, rgba(255,255,255,.03));
  border:1px solid color-mix(in srgb, var(--accent) 28%, rgba(255,255,255,.06))}
#habitQuickMark .qmRow.isDone{background:color-mix(in srgb, var(--accent) 20%, rgba(255,255,255,.04));
  border-color:color-mix(in srgb, var(--accent) 55%, rgba(255,255,255,.08))}
#habitQuickMark .qmDot{width:10px;height:10px;border-radius:50%;background:transparent;border:2px solid color-mix(in srgb, var(--accent) 75%, rgba(255,255,255,.2));box-shadow:0 0 0 4px rgba(0,0,0,.18) inset;flex:0 0 auto}
#habitQuickMark .qmRow.isDone .qmDot{background:var(--accent);border-color:transparent}

/* Negative habit marker: use an X icon instead of the dot */
#habitQuickMark .qmDot.isNeg{width:14px;height:14px;border:none;border-radius:0;background:transparent;box-shadow:none;display:grid;place-items:center;color:color-mix(in srgb, var(--accent) 78%, rgba(255,255,255,.35));}
#habitQuickMark .qmRow.isDone .qmDot.isNeg{color:var(--accent);background:transparent;border:none}
#habitQuickMark .qmDot.isNeg .qmX{width:14px;height:14px;display:block;filter:drop-shadow(0 0 10px color-mix(in srgb, var(--accent) 55%, transparent));}
#habitQuickMark .qmMain{min-width:0;flex:1 1 auto}
#habitQuickMark .qmName{font-weight:650;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
#habitQuickMark .qmMeta{font-size:12px;opacity:.7;margin-top:2px}
#habitQuickMark .qmToggle{flex:0 0 auto;width:46px;height:46px;border-radius:14px;
  border:1px solid rgba(255,255,255,.07);
  background:rgba(255,255,255,.04);
  color:rgba(255,255,255,.92);
  font-weight:900;font-size:18px;
  display:flex;align-items:center;justify-content:center;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
  cursor:pointer;transition:transform .08s ease, filter .12s ease, background .12s ease, border-color .12s ease}

/* Match the Analytics grid colors */
#habitQuickMark .qmRow.isDone .qmToggle{
  background: color-mix(in oklab, var(--accent) 65%, transparent);
  border-color: color-mix(in oklab, var(--accent) 28%, rgba(255,255,255,.07));
}
#habitQuickMark .qmRow.isMissed .qmToggle{
  background: color-mix(in oklab, var(--accent) 12%, rgba(255,255,255,.03));
  opacity: .45;
}
#habitQuickMark .qmToggle:active{transform:scale(.98)}


/* Dashboard: week-over-week delta underline */
.deltaRow{
  margin-top: 10px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.deltaText{
  font-size: 12px;
  color: rgba(255,255,255,0.70);
  white-space: nowrap;
}
.deltaText .up{ color: rgba(52,199,89,0.95); font-weight: 700; }
.deltaText .down{ color: rgba(255,59,48,0.95); font-weight: 700; }

.deltaBar{
  position: relative;
  flex:1;
  height: 6px;
  border-radius: 999px;
  background: rgba(255,255,255,0.08);
  overflow:hidden;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08);
}
.deltaFill{
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: rgba(52,199,89,0.85);
  box-shadow: 0 0 14px rgba(52,199,89,0.18);
  transform-origin: left center;
}
.deltaFill.down{
  background: rgba(255,59,48,0.85);
  box-shadow: 0 0 14px rgba(255,59,48,0.18);
}



/* ----------------------
   Habits: trend underline bar + grid/table view
---------------------- */
.trendWrap{margin-top:10px}
.trendTop{display:flex;align-items:baseline;justify-content:space-between;gap:10px}
.trendDelta{font-weight:700;letter-spacing:0.2px}
.trendDelta.pos{color: rgba(34,197,94,0.95)}
.trendDelta.neg{color: rgba(239,68,68,0.95)}
.trendCaption{font-size:12px;color: rgba(255,255,255,0.55)}
.trendBar{position:relative;height:6px;border-radius:999px;background: rgba(255,255,255,0.08);overflow:hidden;margin-top:6px}
.trendBar.pos{background: rgba(34,197,94,0.12)}
.trendBar.neg{background: rgba(239,68,68,0.12)}
.trendBar .trendFill{height:100%;border-radius:999px;background: currentColor;color: rgba(34,197,94,0.9)}
.trendBar.neg .trendFill{color: rgba(239,68,68,0.9)}
.trendBar.pos .trendFill{color: rgba(34,197,94,0.9)}

/* Table view layout */
.habitTable{display:flex;flex-direction:column;gap:10px}
.habitTableRow{
  display:flex;
  gap:12px;
  padding:12px 12px;
  border-radius:16px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.03);
}
.htrMain{flex:1;min-width:0}
.htrTitleRow{display:flex;align-items:center;justify-content:space-between;gap:10px}
.htrTitleRow strong{max-width: 70%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.htrMeta{margin-top:4px}
.htrRight{display:flex;flex-direction:column;align-items:flex-end;justify-content:center;gap:2px;min-width:72px}
.htrPct{font-weight:800;font-size:18px;line-height:1}

/* Habits list (Month completion numbers) */
.monthProg{height:10px;border-radius:999px;background: rgba(255,255,255,0.08);overflow:hidden;margin-top:10px}
.monthFill{height:100%;border-radius:999px;background: var(--accent, rgba(255,255,255,0.55))}
.htrCount{font-weight:800;font-size:16px;line-height:1.1}

@media (max-width: 520px){
  .habitTableRow{flex-direction:column}
  .htrRight{align-items:flex-start}
  .htrTitleRow strong{max-width: 100%}
}

/* ----------------------
   Habits: Month calendar + month drawer (Dribbble-style)
---------------------- */
.monthCal{width:100%}
.monthCalDow{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:8px;margin: 10px 0 12px 0}
.monthCalDow .dow{font-size:12px;color: rgba(255,255,255,0.55);text-align:center}
.monthCalGrid{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:10px}

.calCell{
  position:relative;
  min-width:0;
  min-height: 66px;
  border-radius:14px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255, calc(0.02 + var(--pct, 0)*0.16));
  display:flex;
  flex-direction:column;
  align-items:flex-start;
  justify-content:space-between;
  padding:10px 10px;
  cursor:pointer;
  transition: transform 120ms ease, border-color 120ms ease, background 120ms ease;
}
.calCell:hover{transform: translateY(-1px); border-color: rgba(255,255,255,0.18)}
.calCell.empty{background: transparent;border-color: transparent;cursor:default;min-height:66px}
.calCell.today{outline: 2px solid rgba(99,102,241,0.55)}
.calDay{font-weight:800;font-size:14px;line-height:1;color: rgba(255,255,255,0.92)}
.calPct{font-weight:800;font-size:12px;color: rgba(255,255,255,0.75)}

@media (max-width: 520px){
  .monthCalGrid{gap:8px}
  .calCell{min-height:58px;padding:9px 9px;border-radius:12px}
  .calPct{font-size:11px}
}

/* Drawer */
.monthDrawer{position:fixed;inset:0;display:none;z-index:60}
.monthDrawer.open{display:block}
.monthDrawerBackdrop{position:absolute;inset:0;background: rgba(0,0,0,0.55);backdrop-filter: blur(2px)}
.monthDrawerSheet{
  position:absolute;top:0;right:0;height:100%;width: min(420px, 92vw);
  background: rgba(10,14,25,0.98);
  border-left: 1px solid rgba(255,255,255,0.10);
  box-shadow: -24px 0 60px rgba(0,0,0,0.45);
  display:flex;flex-direction:column;
  transform: translateX(100%);
  transition: transform 160ms ease;
}
.monthDrawer.open .monthDrawerSheet{transform: translateX(0)}
.monthDrawerHeader{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:16px 16px;border-bottom:1px solid rgba(255,255,255,0.08)}
.monthDrawerTitle{font-weight:900;letter-spacing:0.2px}
.monthDrawerBody{padding:14px 16px;overflow:auto;display:flex;flex-direction:column;gap:10px}

.monthHabitRow{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  border-radius:16px;
  padding:12px 12px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.03);
}
.mhrLeft{min-width:0}
.mhrName{font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.mhrMeta{margin-top:2px;font-size:12px;color: rgba(255,255,255,0.55)}
.mhrRight{min-width: 120px;display:flex;align-items:center;gap:10px}
.mhrBar{flex:1;height:6px;border-radius:999px;background: rgba(255,255,255,0.10);overflow:hidden}
.mhrFill{height:100%;border-radius:999px;background: var(--habit-accent, rgba(99,102,241,0.9))}
.mhrPct{font-weight:900;font-size:12px;color: rgba(255,255,255,0.78);min-width: 34px;text-align:right}

@media (min-width: 1000px){
  /* On wide screens, keep the drawer visually lighter (still overlay) */
  .monthDrawerSheet{width: 420px}
}



/* -------------------------
   Year view (heatmap per habit)
-------------------------- */
.yearView{display:flex;flex-direction:column;gap:14px}
.yearPickerRow{display:flex;justify-content:flex-start}
.yearPicker{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:16px;border:1px solid rgba(255,255,255,0.10);background: rgba(255,255,255,0.03)}
.yearPickerLabel{font-size:12px;color: rgba(255,255,255,0.60);font-weight:700}
.yearSelect{appearance:none;background: rgba(0,0,0,0.20);color: rgba(255,255,255,0.92);border:1px solid rgba(255,255,255,0.12);border-radius:12px;padding:8px 10px;font-weight:800;min-width: 220px}

.yearSummary{display:flex;gap:14px;align-items:flex-start;justify-content:space-between;padding:14px 14px;border-radius:20px;border:1px solid rgba(255,255,255,0.10);background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02))}
.yearKicker{font-size:11px;letter-spacing:.12em;text-transform:uppercase;color: rgba(255,255,255,0.55);font-weight:800}
.yearHabitName{font-size:18px;font-weight:950;margin-top:2px}
.yearMeta{margin-top:6px;font-size:12px;color: rgba(255,255,255,0.65);font-weight:700}
.yearSummaryStats{display:grid;grid-template-columns:repeat(2,minmax(120px,1fr));gap:10px;min-width: 320px}
.yStat{padding:10px 10px;border-radius:16px;border:1px solid rgba(255,255,255,0.08);background: rgba(0,0,0,0.18)}
.yStat .k{font-size:11px;color: rgba(255,255,255,0.55);font-weight:800}
.yStat .v{margin-top:2px;font-size:16px;font-weight:950}
.yStat .sub{font-size:11px;color: rgba(255,255,255,0.60);font-weight:800;margin-left:6px}

.yearMonths{display:grid;grid-template-columns:repeat(auto-fit, minmax(210px, 1fr));gap:12px}
.monthCard{padding:12px 12px;border-radius:18px;border:1px solid rgba(255,255,255,0.10);background: rgba(255,255,255,0.03);transition: transform .12s ease, border-color .12s ease;min-width:0}
.monthCard:hover{transform: translateY(-1px);border-color: rgba(255,255,255,0.18)}
.monthHead{display:flex;align-items:baseline;justify-content:space-between;gap:10px;margin-bottom:10px}
.monthTitle{font-weight:950;font-size:13px;letter-spacing:.04em;text-transform:uppercase}
.monthMeta{font-size:12px;color: rgba(255,255,255,0.60);font-weight:800}
.yHeat{display:grid;grid-template-columns:repeat(7, minmax(0, 1fr));gap:4px}
.yCell{aspect-ratio: 1/1;border-radius:6px;border:1px solid rgba(255,255,255,0.10);background: rgba(255,255,255,0.03);min-width:0}
.yCell.done{background: color-mix(in oklab, var(--habit-accent, rgba(99,102,241,0.85)) 70%, rgba(0,0,0,0));border-color: color-mix(in oklab, var(--habit-accent, rgba(99,102,241,0.85)) 55%, rgba(255,255,255,0.18))}
.yCell.today{outline: 2px solid rgba(255,255,255,0.28);outline-offset: 1px}
.yCell.disabled{opacity: .35}
.yCell.empty{border-color: transparent;background: transparent}

/* Month intensity cue on card edge */
.monthCard.lvl0{box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06)}
.monthCard.lvl1{box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--habit-accent) 18%, rgba(255,255,255,0.08))}
.monthCard.lvl2{box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--habit-accent) 32%, rgba(255,255,255,0.08))}
.monthCard.lvl3{box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--habit-accent) 48%, rgba(255,255,255,0.08))}
.monthCard.lvl4{box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--habit-accent) 68%, rgba(255,255,255,0.08))}

/* -------------------------
   Year list rows
-------------------------- */
.habitYearRow{border-radius:18px;border:1px solid rgba(255,255,255,0.10);background: rgba(255,255,255,0.03);padding:12px 12px;display:flex;flex-direction:column;gap:10px}
.hyrTop{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
.hyrTitle{display:flex;align-items:center;gap:10px;min-width:0}
.hyrTitle strong{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.hyrCount{font-weight:950;color: rgba(255,255,255,0.85)}
.hyrBar{display:flex;gap:6px}
.hyrSeg{flex:1;height:10px;border-radius:999px;background: rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.10)}
.hyrSeg.lvl0{opacity:.30}
.hyrSeg.lvl1{background: color-mix(in oklab, var(--accent) 18%, rgba(255,255,255,0.08))}
.hyrSeg.lvl2{background: color-mix(in oklab, var(--accent) 32%, rgba(255,255,255,0.08))}
.hyrSeg.lvl3{background: color-mix(in oklab, var(--accent) 48%, rgba(255,255,255,0.08))}
.hyrSeg.lvl4{background: color-mix(in oklab, var(--accent) 68%, rgba(255,255,255,0.08))}
.hyrMeta{display:flex;flex-wrap:wrap;gap:10px;font-size:12px;color: rgba(255,255,255,0.65);font-weight:700}
.hyrMeta b{color: rgba(255,255,255,0.86)}

/* -------------------------
   All-time (collapsible years)
-------------------------- */
.allTimeYears{display:block}
.allTimeTop{display:flex;align-items:flex-end;justify-content:space-between;gap:14px;margin:2px 0 12px 0}
.allTimeTitle .kicker{font-size:11px;letter-spacing:.12em;text-transform:uppercase;color: rgba(255,255,255,0.55);font-weight:900}
.allTimeTitle .headline{font-size:18px;font-weight:950;margin-top:2px}
.allTimePick{display:flex;flex-direction:column;gap:6px;align-items:flex-end}
.yearsStack{display:flex;flex-direction:column;gap:12px}
.yearBlock{border-radius:20px;border:1px solid rgba(255,255,255,0.10);background: rgba(255,255,255,0.03);overflow:hidden}
.yearBlock summary{list-style:none;display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 12px;cursor:pointer}
.yearBlock summary::-webkit-details-marker{display:none}
.ybYear{font-size:16px;font-weight:950}
.ybMeta{margin-top:2px;font-size:12px;color: rgba(255,255,255,0.60);font-weight:800}
.ybChevron{opacity:.75;transition: transform .14s ease;font-weight:900}
.yearBlock[open] .ybChevron{transform: rotate(180deg)}
.ybBody{padding:12px 12px 14px 12px}
.ybBody .monthCard{background: rgba(255,255,255,0.02)}

/* -------------------------
   All-time list view (lifetime cards)
-------------------------- */
.allListHeader{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:6px 0 12px 0}
.allListMeta .muted{color: rgba(255,255,255,0.55)}
.lifeGrid{display:grid;grid-template-columns:repeat(auto-fit, minmax(260px, 1fr));gap:12px}
.lifeCard{border-radius:20px;border:1px solid rgba(255,255,255,0.10);background: rgba(255,255,255,0.03);padding:12px 12px;display:flex;flex-direction:column;gap:10px;position:relative}
.lifeCard::after{content:"";position:absolute;inset:0;border-radius:20px;box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--accent) 18%, rgba(255,255,255,0.06));pointer-events:none}
.lifeTop{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
.lifeTitle{display:flex;align-items:center;gap:10px;min-width:0}
.lifeTitle strong{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.lifePct{font-weight:950;font-size:18px;color: rgba(255,255,255,0.90)}
.lifeSub{display:flex;flex-wrap:wrap;gap:8px;align-items:center;color: rgba(255,255,255,0.65);font-weight:800}
.dotSep{opacity:.5}
.miniTimeline{display:flex;gap:6px;align-items:center}
.tlSeg{flex:1;height:10px;border-radius:999px;background: rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.10)}
.tlSeg.lvl0{opacity:.30}
.tlSeg.lvl1{background: color-mix(in oklab, var(--accent) 18%, rgba(255,255,255,0.08))}
.tlSeg.lvl2{background: color-mix(in oklab, var(--accent) 32%, rgba(255,255,255,0.08))}
.tlSeg.lvl3{background: color-mix(in oklab, var(--accent) 48%, rgba(255,255,255,0.08))}
.tlSeg.lvl4{background: color-mix(in oklab, var(--accent) 68%, rgba(255,255,255,0.08))}
.lifeFoot{display:flex;align-items:center;justify-content:space-between;gap:12px;color: rgba(255,255,255,0.70);font-weight:800}
.lifeFoot .up{color: rgba(76, 217, 100, 0.95)}
.lifeFoot .down{color: rgba(255, 107, 107, 0.95)}
.lifeBadge{font-size:11px;font-weight:950;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,0.12);background: rgba(0,0,0,0.22);white-space:nowrap}
.lifeBadge.bGood{box-shadow: inset 0 0 0 1px rgba(76,217,100,0.28)}
.lifeBadge.bUp{box-shadow: inset 0 0 0 1px rgba(64,156,255,0.28)}
.lifeBadge.bWarn{box-shadow: inset 0 0 0 1px rgba(255,193,7,0.28)}

@media (max-width: 720px){
  .allTimeTop{flex-direction:column;align-items:flex-start}
  .allTimePick{align-items:flex-start;width:100%}
  .allTimePick .select{width:100%}
}


/* Premium dropdown (Habits: Year / All Time) */
.selectWrap{position:relative;display:inline-flex;align-items:center;max-width:100%}
.selectWrap::after{
  content:"";
  position:absolute;
  right:12px;
  width:14px;height:14px;
  pointer-events:none;
  opacity:.85;
  background-repeat:no-repeat;
  background-position:center;
  background-size:14px 14px;
  /* chevron-down */
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23c7d2fe' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
}
.premiumSelect{
  -webkit-appearance:none;
  appearance:none;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.14);
  border-radius:14px;
  padding:10px 40px 10px 12px;
  color:#e5e7eb;
  font-weight:650;
  letter-spacing:.2px;
  line-height:1.2;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.08), 0 8px 22px rgba(0,0,0,.25);
  backdrop-filter:blur(10px);
  max-width:100%;
}
.premiumSelect:hover{border-color:rgba(255,255,255,.22)}
.premiumSelect:focus{
  outline:none;
  border-color:rgba(99,102,241,.75);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.08), 0 0 0 3px rgba(99,102,241,.22), 0 10px 26px rgba(0,0,0,.30);
}
.premiumSelect option{
  background:#0b1220;
  color:#e5e7eb;
}


/* Month view: weekend shading + selected day state + better low-% contrast */
.calCell.weekend{
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06), inset 0 18px 34px rgba(255,255,255,0.04);
}
.calCell.isZero .calPct{color: rgba(255,255,255,0.92)}
.calCell.isLow .calPct{color: rgba(255,255,255,0.86)}
.calCell.selected{
  outline: 2px solid rgba(140,180,255,0.85);
  box-shadow:
    0 0 0 4px rgba(140,180,255,0.14),
    0 0 18px rgba(140,180,255,0.22),
    inset 0 0 0 1px rgba(255,255,255,0.06);
}
.calCell.selected:not(.today) .calDay{filter: brightness(1.08)}

/* Day details modal rows */
.dayMeta{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px}
.dayMetaChip{
  padding:6px 10px;border-radius:999px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.10);
  color: rgba(255,255,255,0.85);
  font-size:12px;font-weight:700;
}
.dayRows{display:flex;flex-direction:column;gap:10px}
.dayRow{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  padding:12px 12px;border-radius:14px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
}
.dayLeft{display:flex;align-items:center;gap:10px;min-width:0}
.dayDot{width:10px;height:10px;border-radius:999px;background: var(--accent, rgba(255,255,255,0.7)); box-shadow: 0 0 0 4px rgba(255,255,255,0.06)}
.dayName{font-weight:800;color: rgba(255,255,255,0.92);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width: 44vw}
.dayStatus{font-size:12px;font-weight:800;color: rgba(255,255,255,0.65)}
.dayStatus.isDone{color: rgba(170, 255, 200, 0.92)}
.dayStatus.isMissed{color: rgba(255, 190, 160, 0.90)}
.dayActions{display:flex;gap:8px;flex-shrink:0}
.btnSmall{
  padding:8px 10px;border-radius:12px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04);
  color: rgba(255,255,255,0.90);
  font-weight:800;font-size:12px;
}
.btnSmall.primary{
  background: rgba(140,180,255,0.16);
  border-color: rgba(140,180,255,0.30);
}
.btnSmall:active{transform: translateY(1px)}


/* --- Mobile fixes: Year view month cards should not overflow --- */
@media (max-width: 560px){
  .yearMonths{
    grid-template-columns: 1fr !important;
  }
  .monthCard{min-width:0}
  .yHeat{grid-template-columns: repeat(7, minmax(0, 1fr));}
  .yCell{min-width:0}
}


/* --- Mobile fix: Year summary should not overflow --- */
@media (max-width: 560px){
  .yearSummary{flex-direction: column; align-items: stretch;}
  .yearSummaryStats{min-width: 0 !important; width: 100%; grid-template-columns: repeat(2, minmax(0, 1fr));}
  .yearSelect{min-width: 0; width: 100%;}
}
@media (max-width: 380px){
  .yearSummaryStats{grid-template-columns: 1fr;}
}


/* ===== Premium Month Calendar (Habits) ===== */
.monthCal{
  --radius:18px;
  --gap:14px;
  --cardH:104px;
}

.monthCalDow{
  display:grid;
  grid-template-columns:repeat(7, minmax(0, 1fr));
  gap:var(--gap);
  margin-bottom:var(--gap);
  text-align:center;
  letter-spacing:.18em;
  font-weight:800;
  font-size:12px;
  color:#93c5fd;
  user-select:none;
}

.monthCalGrid{
  display:grid;
  grid-template-columns:repeat(7, minmax(0, 1fr));
  gap:var(--gap);
}

.calCell.calDayCard{
  position:relative;
  height:var(--cardH);
  padding:14px;
  border-radius:var(--radius);
  background:linear-gradient(180deg,rgba(255,255,255,.075),rgba(255,255,255,.03));
  border:1px solid rgba(255,255,255,.12);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  isolation:isolate;
  min-width:0;

  box-shadow:
    0 18px 40px rgba(0,0,0,.55),
    inset 0 1px 0 rgba(255,255,255,.07),
    inset 0 -12px 18px rgba(0,0,0,.25);

  transform: translateZ(0);
  transition: transform .22s ease, border-color .22s ease, box-shadow .22s ease;
  will-change: transform;
  opacity:0;
  transform: translateY(10px) scale(.985);
  animation: calPopIn .55s ease forwards;
  animation-delay: var(--delay, 0ms);
}

@keyframes calPopIn{ to{ opacity:1; transform: translateY(0) scale(1);} }

/* Glow aura behind card */
.calCell.calDayCard::before{
  content:"";
  position:absolute;
  inset:-18px;
  border-radius: calc(var(--radius) + 18px);
  background: radial-gradient(circle at 50% 30%, var(--glowColor, rgba(59,130,246,.35)), transparent 65%);
  filter:blur(22px);
  opacity:.22;
  transition: opacity .25s ease;
  z-index:-1;
  pointer-events:none;
}

.calCell.calDayCard:hover{
  transform: translateY(-4px) scale(1.02);
  border-color: rgba(255,255,255,.18);
  box-shadow:
    0 28px 70px rgba(0,0,0,.66),
    inset 0 1px 0 rgba(255,255,255,.085),
    inset 0 -12px 18px rgba(0,0,0,.28);
}

.calCell.calDayCard:hover::before{ opacity:.80; }

/* Shine sweep */
.calCell.calDayCard .shine{
  position:absolute; inset:0;
  border-radius: var(--radius);
  background: linear-gradient(
    120deg,
    transparent 0%,
    rgba(255,255,255,.22) 24%,
    rgba(255,255,255,.10) 36%,
    transparent 58%
  );
  transform: translateX(-85%);
  opacity:0;
  pointer-events:none;
  z-index:1;
}
.calCell.calDayCard:hover .shine{
  opacity:1;
  animation: calShine .85s ease forwards;
}
@keyframes calShine{ to{ transform: translateX(85%);} }

.calTop{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:10px;
  position:relative;
  z-index:2;
}

.calNum{
  font-size:30px;
  font-weight:850;
  line-height:1;
  letter-spacing:-.02em;
  text-shadow:0 12px 26px rgba(0,0,0,.35);
}

.calPctNum{
  font-size:16px;
  font-weight:800;
  color: rgba(255,255,255,.88);
  text-shadow:0 10px 22px rgba(0,0,0,.30);
}

/* Progress bar */
.calBar{
  height:12px;
  border-radius:999px;
  background:rgba(0,0,0,.38);
  overflow:hidden;
  border:1px solid rgba(255,255,255,.10);
  box-shadow: inset 0 10px 18px rgba(0,0,0,.35);
  position:relative;
  z-index:2;
}
.calFill{
  height:100%;
  width:0%;
  border-radius:999px;
  background: var(--barColor, rgba(59,130,246,.7));
  transition: width .9s cubic-bezier(.2,.8,.2,1);
}

/* Today + Selected rings (keeps existing semantics) */
.calCell.calDayCard.today{
  outline: 2px solid rgba(255,255,255,.18);
  box-shadow:
    0 0 0 1px rgba(255,255,255,.10),
    0 18px 44px rgba(0,0,0,.62),
    0 0 0 4px rgba(59,130,246,.12),
    inset 0 1px 0 rgba(255,255,255,.085),
    inset 0 -12px 18px rgba(0,0,0,.26);
}
.calCell.calDayCard.selected{
  outline: 2px solid rgba(168,85,247,.32);
  box-shadow:
    0 0 0 1px rgba(255,255,255,.08),
    0 18px 44px rgba(0,0,0,.62),
    0 0 0 4px rgba(168,85,247,.10),
    inset 0 1px 0 rgba(255,255,255,.085),
    inset 0 -12px 18px rgba(0,0,0,.26);
}

/* Weekend shading: subtle, premium */
.calCell.calDayCard.weekend{
  background:linear-gradient(180deg,rgba(255,255,255,.065),rgba(255,255,255,.022));
}

/* Low pct readability */
.calCell.calDayCard.isZero .calPctNum,
.calCell.calDayCard.isLow .calPctNum{
  color: rgba(255,255,255,.94);
  opacity: 0.92;
}

/* Empty slots keep grid alignment */
.monthCalGrid .calCell.empty{
  visibility:hidden;
  border:none !important;
  box-shadow:none !important;
  background:transparent !important;
  height:var(--cardH);
}

/* Responsive: keep 7 columns but tighten sizing */
@media (max-width: 980px){
  .monthCal{ --gap:12px; --cardH:98px; --radius:16px; }
  .calNum{ font-size:28px; }
  .calPctNum{ font-size:14px; }
}

/* ---------------------------------------------
   Habits: Mobile Weekly (<= 900px)
   Card list layout with 7-day pill buttons.
   Keeps existing interactions by styling `.matrixCell`.
----------------------------------------------*/

@media (max-width: 900px){
  .matrixGrid.mobileWeekly{
    padding: 0;
  }

  .mwPanel{
    width: 100%;
    padding: 16px 14px 16px;
    border-radius: 26px;
    background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    border: 1px solid rgba(255,255,255,.10);
    box-shadow: 0 24px 70px rgba(0,0,0,.55);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
  }

  .mwPanel::before{
    content:"";
    position:absolute;
    inset:-2px;
    background:
      radial-gradient(700px 210px at 50% 0%, rgba(255,255,255,.12), transparent 55%),
      radial-gradient(260px 260px at 14% 88%, rgba(124, 92, 255,.10), transparent 60%),
      radial-gradient(240px 240px at 90% 82%, rgba(91, 140, 255,.10), transparent 60%);
    pointer-events:none;
  }

  /* Weekday labels are rendered per-row (above the dots) */

  .mwList{
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .mwRow{
    padding: 12px 14px 10px;
    isolation: isolate;
    border-radius: 22px;
    background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
    border: 1px solid rgba(255,255,255,.07);
    box-shadow: 0 10px 26px rgba(0,0,0,.28);
    overflow: hidden;
    position: relative;
  }
  .mwRow > *{
    position: relative;
    z-index: 2;
  }

  /* hold-to-delete loading bar on the whole row (visible + glow) */
  .mwRow.holding{
    border-color: rgba(255,255,255,.18);
  }

  /* main fill */
  .mwRow.holding::after{
    content:"";
    position:absolute;
    inset:0;
    border-radius: 22px;
    /* Red "loading" fill (left -> right) */
    background: linear-gradient(90deg,
      rgba(255, 66, 66, 0.78),
      rgba(255, 66, 66, 0.18));
    transform-origin: left center;
    transform: scaleX(var(--hold, 0));
    opacity: 1;
    pointer-events:none;
    z-index: 0;
    will-change: transform;
    box-shadow:
      0 0 18px rgba(255, 66, 66, 0.35),
      0 18px 44px rgba(255, 66, 66, 0.22);
  }

  /* subtle glow while holding (no fancy calc() multiplications for compatibility) */
  .mwRow.holding::before{
    content:"";
    position:absolute;
    inset:0;
    border-radius: 22px;
    /* Soft red glow while holding */
    background: rgba(255, 66, 66, 0.10);
    filter: blur(10px);
    opacity: 1;
    pointer-events:none;
    z-index: 1;
    mix-blend-mode: screen;
  }
  .mwTop{
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
  }

  .mwLeft{
    display: flex;
    align-items: center;
    gap: 10px;
    touch-action: none; /* allow long-press without scroll cancel */
    min-width: 0;
  }

  .mwDot{
    width: 14px;
    height: 14px;
    border-radius: 999px;
    background: var(--habit-accent);
    box-shadow:
      0 0 0 6px rgba(255,255,255,.02),
      0 10px 22px color-mix(in oklab, var(--habit-accent) 22%, transparent);
  }

  .mwName{
    font-size: 16px;
    font-weight: 650;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 220px;
  }

  .mwCount{
    font-size: 13px;
    font-weight: 650;
    color: rgba(255,255,255,.62);
    min-width: 44px;
    text-align: right;
  }

  .mwDays{
    margin-top: 10px;
    display: grid;
    grid-template-columns: repeat(7, minmax(0, 1fr));
    gap: 8px;
    padding: 0;
    background: transparent;
    border: 0;
    box-shadow: none;
  }

  .mwCol{
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    min-width: 0;
  }

  .mwLbl{
    font-size: 11px;
    font-weight: 650;
    letter-spacing: .22em;
    text-transform: uppercase;
    color: rgba(255,255,255,.52);
    line-height: 1;
    user-select: none;
  }

  /* Override the matrix cell look to match the mobile pill style */
  .mwPanel .mwDay.matrixCell{
    width: 100%;
    max-width: 36px;
    height: 18px;
    border-radius: 999px;
    padding: 0;
    background: rgba(255,255,255,.035);
    border: 1px solid rgba(255,255,255,.075);
    box-shadow:
      inset 0 1px 0 rgba(255,255,255,.06),
      0 8px 18px rgba(0,0,0,.20);
    cursor: pointer;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    transition: transform .15s ease, border-color .18s ease, box-shadow .18s ease;
  }

  .mwPanel .mwDay.matrixCell:active{ transform: scale(.99); }

  .mwPanel .mwDay.matrixCell.done{
    background:
      radial-gradient(circle at 30% 30%,
        color-mix(in oklab, var(--habit-accent) 72%, #fff 0%),
        color-mix(in oklab, var(--habit-accent) 55%, transparent) 60%),
      rgba(255,255,255,.03);
    border-color: color-mix(in oklab, var(--habit-accent) 38%, rgba(255,255,255,.10));
    box-shadow:
      0 0 0 8px color-mix(in oklab, var(--habit-accent) 18%, transparent),
      0 14px 26px color-mix(in oklab, var(--habit-accent) 18%, transparent),
      inset 0 1px 0 rgba(255,255,255,.10);
  }

  /* Keep missed as neutral on mobile list */
  .mwPanel .mwDay.matrixCell.missed{
    background: rgba(255,255,255,.03);
  }

  /* Removed inline add button on mobile weekly (use the global +Add Habit). */
}
@media (max-width: 520px){
  .monthCal{ --gap:10px; --cardH:92px; --radius:16px; }
  .calCell.calDayCard{ padding:12px; }
  .calNum{ font-size:26px; }
  .calPctNum{ font-size:13px; }
  .calBar{ height:11px; }
}

/* Reduce motion support */
@media (prefers-reduced-motion: reduce){
  .calCell.calDayCard{ animation:none; opacity:1; transform:none; }
  .calFill{ transition:none; }
  .calCell.calDayCard:hover{ transform:none; }
  .calCell.calDayCard:hover .shine{ animation:none; }
}


/* ===== Premium Month Calendar: Mobile layout improvements ===== */
@media (max-width: 720px){
  /* Use 4 columns for readability on phones */
  .monthCalDow{ display:none; }
  .monthCalGrid{ grid-template-columns:repeat(4, minmax(0, 1fr)); }

  .monthCal{ --gap:10px; --cardH:92px; --radius:16px; }
  .calCell.calDayCard{ padding:12px; }
  .calNum{ font-size:28px; }
  .calPctNum{ font-size:13px; }
  .calBar{ height:11px; }
}
@media (max-width: 420px){
  /* Small phones: 3 columns */
  .monthCalGrid{ grid-template-columns:repeat(3, minmax(0, 1fr)); }

  .monthCal{ --gap:10px; --cardH:90px; --radius:16px; }
  .calCell.calDayCard{ padding:12px; }
  .calNum{ font-size:28px; }
}


/* Month card: place percent under the day to avoid cut-off on small screens */
.calPctRow{
  display:flex;
  justify-content:flex-end;
  margin-top:6px;
  position:relative;
  z-index:2;
}

/* Month card: pct row mobile */
@media (max-width: 420px){
  .calPctRow{ justify-content:flex-start; margin-top:6px; }
  .calPctNum{ font-size:12px; }
  .calNum{ font-size:26px; }
}


/* ===== Premium Overall Trend Bar (Habits) ===== */
.overallTrend{
  position:relative;
  margin-top:12px;
  border-radius:18px;
  padding:12px 12px 12px;
  background:
    radial-gradient(700px 220px at 15% 10%, rgba(255,255,255,.070), transparent 55%),
    linear-gradient(180deg, rgba(255,255,255,.050), rgba(255,255,255,.020));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:
    0 26px 70px rgba(0,0,0,.55),
    inset 0 1px 0 rgba(255,255,255,.06);
  overflow:hidden;
  backdrop-filter: blur(16px);
  --fillA:#a855f7;
  --fillB:#3b82f6;
  --dotA:#a855f7;
  --dotB:#3b82f6;
}
.overallTrend.up{
  --fillA:#22c55e;
  --fillB:#0ea5e9;
  --dotA:#22c55e;
  --dotB:#0ea5e9;
}
.overallTrend.down{
  --fillA:#ef4444;
  --fillB:#f97316;
  --dotA:#ef4444;
  --dotB:#f97316;
}

/* subtle grain overlay */
.overallTrend::after{
  content:"";
  position:absolute; inset:0;
  pointer-events:none;
  opacity:.10;
  mix-blend-mode:overlay;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
}

/* right vertical accent */
.overallTrend .trendAccent{
  position:absolute;
  right:0; top:0; bottom:0;
  width:2px;
  background: linear-gradient(180deg, transparent, rgba(168,85,247,.85), transparent);
  opacity:.9;
}

/* top row */
.overallTrend .trendTop{
  position:relative;
  z-index:1;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-bottom:10px;
  font-size:12px;
  letter-spacing:.02em;
}
.overallTrend .trendLeft{ min-width:0; }
.overallTrend .trendRight{
  color: rgba(255,255,255,.72);
  white-space:nowrap;
}
.overallTrend .trendPct{ color: rgba(255,255,255,.92); font-weight:800; }

/* pill */
.overallTrend .trendPill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:7px 11px;
  border-radius:999px;
  background: rgba(255,255,255,.055);
  border: 1px solid rgba(255,255,255,.12);
  box-shadow:
    0 10px 26px rgba(0,0,0,.25),
    inset 0 1px 0 rgba(255,255,255,.08);
  white-space:nowrap;
  max-width: 100%;
}
.overallTrend .trendDelta{
  color: rgba(255,255,255,.78);
  overflow:hidden;
  text-overflow:ellipsis;
}
.overallTrend .trendDot{
  width:7px;height:7px;border-radius:999px;
  background: linear-gradient(90deg, var(--dotA), var(--dotB));
  box-shadow: 0 10px 18px rgba(239,68,68,.14);
}

/* line bar */
.overallTrend .trendBar{
  position:relative;
  z-index:1;
  height:10px;
  border-radius:999px;
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
  border:1px solid rgba(255,255,255,.12);
  box-shadow:
    inset 0 10px 18px rgba(0,0,0,.45),
    inset 0 1px 0 rgba(255,255,255,.08),
    0 18px 40px rgba(0,0,0,.35);
  overflow:hidden;
}
/* glow ring around bar */
.overallTrend .trendBar::before{
  content:"";
  position:absolute;
  inset:-10px;
  border-radius:999px;
  background: radial-gradient(circle at 30% 50%, rgba(249,115,22,.18), transparent 55%);
  filter: blur(14px);
  opacity:.45;
  pointer-events:none;
}
/* fill */
.overallTrend .trendFill{
  height:100%;
  width:0%;
  border-radius:999px;
  background: linear-gradient(90deg, var(--fillA), var(--fillB));
  box-shadow:
    0 0 28px rgba(249,115,22,.14),
    0 18px 40px rgba(239,68,68,.08),
    inset 0 1px 0 rgba(255,255,255,.14);
  position:relative;
  filter:saturate(1.05);
  transition: width .9s cubic-bezier(.2,.8,.2,1);
}
/* sweep highlight */
.overallTrend .trendFill::after{
  content:"";
  position:absolute; inset:-2px;
  background: linear-gradient(90deg,
    transparent 0%,
    rgba(255,255,255,.35) 35%,
    rgba(255,255,255,.10) 50%,
    transparent 70%
  );
  transform: translateX(-80%);
  opacity:0;
}
.overallTrend:hover .trendFill::after{
  opacity:1;
  animation: trendSweep .9s ease forwards;
}
@keyframes trendSweep{ to{ transform: translateX(70%);} }

/* end-cap glow */
.overallTrend .trendFill::before{
  content:"";
  position:absolute;
  right:-18px;
  top:50%;
  width:52px;height:52px;
  transform: translateY(-50%);
  background: radial-gradient(circle, rgba(249,115,22,.55), transparent 65%);
  filter: blur(8px);
  opacity:.85;
  pointer-events:none;
}

/* responsive */
@media (max-width: 520px){
  .overallTrend{ padding: 11px 10px 11px; border-radius:16px; }
  .overallTrend .trendTop{ font-size:11px; margin-bottom:9px; }
  .overallTrend .trendBar{ height:9px; }
  .overallTrend .trendPill{ padding:6px 10px; }
}


/* ===== Quick Mark: Premium Habit Cards ===== */
.qmHead{
  padding: 10px 6px 12px;
}
.qmTitle{
  font-size: 18px;
  font-weight: 800;
  letter-spacing: -0.01em;
}
.qmSub{
  font-size: 13px;
  opacity: .65;
  margin-top: 2px;
}

.qmList{
  display:grid;
  gap:14px;
}

.hmCard{
  position:relative;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:16px 16px;
  border-radius: 18px;
  border:1px solid rgba(255,255,255,.10);
  box-shadow: 0 18px 40px rgba(0,0,0,.55);
  overflow:hidden;
  transform: translateZ(0);
  outline:2px solid rgba(255,255,255,.03);
}

.hmCard::before{
  content:"";
  position:absolute;
  inset:-1px;
  border-radius:inherit;
  pointer-events:none;
  opacity:.9;
  background: radial-gradient(240px 120px at 0% 35%, rgba(255,255,255,.16), transparent 55%);
}

.hmCard::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  opacity:.08;
  mix-blend-mode:overlay;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.45'/%3E%3C/svg%3E");
}

.hmLeft{
  display:flex;
  align-items:center;
  gap:12px;
  position:relative;
  z-index:1;
  min-width: 0;
}

.hmText{ min-width:0; }
.hmName{
  font-size: 18px;
  font-weight: 800;
  letter-spacing: -0.01em;
  line-height: 1.05;
  white-space: nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.hmMeta{
  font-size: 12px;
  opacity: .70;
  margin-top: 3px;
}

.hmStatus{
  width:26px;height:26px;
  border-radius:999px;
  display:grid;
  place-items:center;
  font-weight: 900;
  font-size: 15px;
  flex:0 0 auto;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.18);
}
.hmStatus--idle{
  background: rgba(0,0,0,.20);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.06);
}
.hmStatus--done{
  background: rgba(255,255,255,.16);
  box-shadow: 0 0 0 6px rgba(255,255,255,.06);
}

.hmBadge{
  width:52px;
  height:52px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.12);
  /* Default (NOT marked): neutral so it doesn't inherit the card tint */
  background: rgba(10,12,18,.72);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.08),
    inset 0 0 0 1px rgba(0,0,0,.22),
    0 10px 25px rgba(0,0,0,.35);
  position:relative;
  z-index:1;
  cursor:pointer;
}

/* Marked (done or missed): tinted with the habit accent */
.hmBadge.is-on{
  border-color: rgba(255,255,255,.14);
  background:
    radial-gradient(80px 60px at 30% 25%, rgba(255,255,255,.18), transparent 62%),
    linear-gradient(
      180deg,
      color-mix(in srgb, var(--accent) 70%, rgba(255,255,255,.10)),
      color-mix(in srgb, var(--accent) 35%, rgba(0,0,0,.22))
    );
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.10),
    inset 0 0 0 1px rgba(0,0,0,.18),
    0 10px 25px rgba(0,0,0,.35),
    0 0 34px color-mix(in srgb, var(--accent) 55%, transparent);
}

/* Missed gets a slightly more muted treatment */
.hmCard.is-missed .hmBadge.is-on{
  filter: saturate(.90) brightness(.92);
}


/* Variants: hue-based (accent still comes from data) */
.hmCard--green{
  background:
    radial-gradient(420px 220px at 20% 30%, color-mix(in srgb, var(--accent) 55%, transparent) , transparent 60%),
    linear-gradient(135deg, rgba(15,50,40,.95), rgba(10,24,28,.92));
  border-color: color-mix(in srgb, var(--accent) 35%, rgba(255,255,255,.10));
}
.hmCard--purple{
  background:
    radial-gradient(420px 220px at 20% 30%, color-mix(in srgb, var(--accent) 55%, transparent) , transparent 60%),
    linear-gradient(135deg, rgba(44,27,92,.96), rgba(22,16,45,.92));
  border-color: color-mix(in srgb, var(--accent) 30%, rgba(255,255,255,.10));
}
.hmCard--orange{
  background:
    radial-gradient(420px 220px at 20% 30%, color-mix(in srgb, var(--accent) 55%, transparent) , transparent 60%),
    linear-gradient(135deg, rgba(76,40,30,.96), rgba(28,18,20,.92));
  border-color: color-mix(in srgb, var(--accent) 30%, rgba(255,255,255,.10));
}

/* Completed emphasis */
.hmCard.is-done .hmMeta{ opacity:.82; }
.hmCard.is-done .hmStatus--done{ border-color: rgba(255,255,255,.25); }

/* Hover */
.hmCard:hover{
  transform: translateY(-2px);
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
  box-shadow:
    0 0 0 1px rgba(255,255,255,.06),
    0 0 26px rgba(255,255,255,.06),
    0 0 40px color-mix(in srgb, var(--accent) 55%, transparent),
    0 18px 40px rgba(0,0,0,.55);
}

/* Mobile tweak */
@media (max-width:420px){
  .hmName{ font-size:16px; }
  .hmBadge{ width:48px; height:48px; border-radius:14px; }
}


/* Premium Overall Trend Bar: extra-small screens */
@media (max-width: 420px){
  .overallTrend .trendTop{
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }
  .overallTrend .trendRight{ white-space: normal; }
}


/* ===== Quick Mark: Premium Header (Habits + date) ===== */
.hmTopCard{
  padding:22px 22px 18px;
  border-radius: 26px;
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: 0 14px 34px rgba(0,0,0,.45);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  margin-bottom:16px;
}
.hmTopTitle{
  font-size:44px;
  font-weight:800;
  letter-spacing:-.02em;
  line-height:1.05;
}
.hmTopSub{
  font-size:18px;
  color:rgba(234,240,255,.62);
  margin-top:6px;
}
@media (max-width:420px){
  .hmTopTitle{ font-size:38px; }
  .hmTopSub{ font-size:16px; }
}


/* ===== Quick Mark: Right-side toggle emphasis ===== */
.hmStatus{
  width:10px;
  height:10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.10);
  box-shadow: 0 10px 18px rgba(0,0,0,.18);
}
.hmStatus--idle{ box-shadow: inset 0 0 0 2px rgba(255,255,255,.06); }

.hmBadge.hmToggle{
  display:grid;
  place-items:center;
  font-weight:900;
  font-size:18px;
  line-height:1;
}
.hmBadge.hmToggle.is-done{
  background: color-mix(in srgb, var(--accent) 28%, rgba(255,255,255,.10));
  border-color: color-mix(in srgb, var(--accent) 40%, rgba(255,255,255,.12));
}


/* Negative habit indicator (red X) */
.hmStatus--neg{
  width:22px;
  height:22px;
  display:grid;
  place-items:center;
  font-size:14px;
  font-weight:900;
  color:#ff4d4f;
  background: rgba(255,77,79,.12);
  border:1px solid rgba(255,77,79,.45);
  box-shadow: 0 0 12px rgba(255,77,79,.35);
}


/* ===== Status icon refinements ===== */

/* Base reset */
.hmStatus{
  width:22px;
  height:22px;
  display:grid;
  place-items:center;
  font-size:16px;
  font-weight:900;
  background:transparent;
  border:none;
  box-shadow:none;
}

/* Negative (red X) */
.hmStatus--neg{
  color:#ff4d4f;
  text-shadow: 0 0 8px rgba(255,77,79,.55);
}

/* Positive done (green check) */
.hmStatus--pos-done{
  color:#22c55e;
  text-shadow: 0 0 8px rgba(34,197,94,.55);
}

/* Empty state (no circle anymore) */
.hmStatus--empty{
  opacity:.25;
}

/* Ensure hmBadge has no internal text */
.hmBadge.hmToggle{
  font-size:0;
}


/* ===== Habits right side: use empty space on large screens ===== */
.habitsSideGrid{
  display:grid;
  gap:16px;
}
.habitsSideStack{
  display:grid;
  gap:16px;
}

@media (min-width: 980px){
  .habitsSideGrid{
    grid-template-columns: minmax(360px, 1.25fr) minmax(320px, 1fr);
    align-items:start;
  }
  .habitsQuickMarkCard{
    height: fit-content;
  }
}

@media (max-width: 979px){
  .habitsSideGrid{
    grid-template-columns: 1fr;
  }
}


/* Focus hint inside Habits box */
.hmHintInHabits{
  margin-top:14px;
}


/* hmBadge state coloring (so the box is colored no matter where you mark from) */
.hmCard.is-done .hmBadge{
  background: color-mix(in srgb, var(--accent) 26%, rgba(255,255,255,.10));
  border-color: color-mix(in srgb, var(--accent) 40%, rgba(255,255,255,.12));
}
.hmCard.is-missed .hmBadge{
  background: rgba(255,77,79,.10);
  border-color: rgba(255,77,79,.30);
}


/* ===== Focus hint inside Habits header ===== */
.hmFocusHint{
  margin-top:14px;
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.05);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.06),
    0 16px 40px rgba(0,0,0,.35);
  cursor:pointer;
  user-select:none;
}
.hmFocusHint:focus{
  outline:2px solid rgba(59,130,246,.30);
  box-shadow:
    0 0 0 4px rgba(59,130,246,.14),
    inset 0 1px 0 rgba(255,255,255,.06),
    0 16px 40px rgba(0,0,0,.35);
}
.hmFocusHint:hover{
  border-color: rgba(255,255,255,.14);
  transform: translateY(-1px);
  transition: transform .16s ease, border-color .16s ease;
}

.hmFocusIcon{
  width:34px;height:34px;
  border-radius:12px;
  display:grid;
  place-items:center;
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
}
.hmFocusText{ min-width:0; flex:1; }
.hmFocusTitle{
  font-weight:800;
  font-size:13px;
  line-height:1.1;
}
.hmFocusBody{
  margin-top:2px;
  font-size:12px;
  opacity:.75;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.hmFocusCta{
  font-weight:800;
  font-size:12px;
  opacity:.85;
  white-space:nowrap;
}

@media (max-width:420px){
  .hmFocusHint{ padding:10px 10px; border-radius:14px; }
  .hmFocusBody{ white-space:normal; }
}


/* ===== Streaks panel coloring per habit ===== */
.streakItem{
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(320px 160px at 20% 30%, color-mix(in srgb, var(--accent) 22%, transparent), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.06),
    0 18px 40px rgba(0,0,0,.35);
}
.streakItem::before{
  content:"";
  position:absolute;
  left:0; top:0; bottom:0;
  width:2px;
  background: linear-gradient(180deg, transparent, color-mix(in srgb, var(--accent) 80%, transparent), transparent);
  opacity:.9;
}
.streakItem .pill{
  border-color: color-mix(in srgb, var(--accent) 35%, rgba(255,255,255,.12));
  background: color-mix(in srgb, var(--accent) 10%, rgba(255,255,255,.05));
}
.streakBar{
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.08);
  box-shadow: inset 0 10px 18px rgba(0,0,0,.30);
}
.streakFill{
  background: linear-gradient(90deg, color-mix(in srgb, var(--accent) 65%, #22c55e), var(--accent));
  box-shadow: 0 12px 24px color-mix(in srgb, var(--accent) 25%, transparent);
}


/* ===== Habits cards: right square should reflect habit color (like grid) ===== */
.hmCard .hmBadge.is-on{
  /* base: lightly tinted by habit accent */
  background: radial-gradient(140px 90px at 30% 25%,
    color-mix(in srgb, var(--accent) 22%, transparent),
    rgba(255,255,255,.08)
  );
  border-color: color-mix(in srgb, var(--accent) 28%, rgba(255,255,255,.12));
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.10),
    0 10px 25px rgba(0,0,0,.35);
}

/* NOT marked: force neutral (no tint from the card behind) */
.hmCard .hmBadge.is-off{
  background: rgba(10,12,18,.78) !important;
  border-color: rgba(255,255,255,.14) !important;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.08),
    inset 0 0 0 1px rgba(0,0,0,.22),
    0 10px 25px rgba(0,0,0,.35) !important;
  filter: none !important;
}

/* done = stronger fill */
.hmCard.is-done .hmBadge{
  background: linear-gradient(135deg,
    color-mix(in srgb, var(--accent) 40%, rgba(255,255,255,.10)),
    color-mix(in srgb, var(--accent) 18%, rgba(0,0,0,.22))
  );
  border-color: color-mix(in srgb, var(--accent) 46%, rgba(255,255,255,.12));
  box-shadow:
    0 0 0 1px rgba(255,255,255,.05),
    0 0 24px color-mix(in srgb, var(--accent) 35%, transparent),
    inset 0 1px 0 rgba(255,255,255,.12),
    0 10px 25px rgba(0,0,0,.35);
}

/* missed/slipped = red-tinted square */
.hmCard.is-missed .hmBadge{
  background: linear-gradient(135deg, rgba(255,77,79,.22), rgba(0,0,0,.18));
  border-color: rgba(255,77,79,.35);
  box-shadow:
    0 0 0 1px rgba(255,255,255,.04),
    0 0 24px rgba(255,77,79,.20),
    inset 0 1px 0 rgba(255,255,255,.10),
    0 10px 25px rgba(0,0,0,.35);
}


/* ===== Habits badges: stronger glow when marked (matches grid emphasis) ===== */
.hmCard.is-done .hmBadge{
  box-shadow:
    0 0 0 1px rgba(255,255,255,.06),
    0 0 18px color-mix(in srgb, var(--accent) 55%, transparent),
    0 0 42px color-mix(in srgb, var(--accent) 35%, transparent),
    inset 0 1px 0 rgba(255,255,255,.14),
    0 12px 28px rgba(0,0,0,.38);
}

.hmCard.is-missed .hmBadge{
  box-shadow:
    0 0 0 1px rgba(255,255,255,.05),
    0 0 18px rgba(255,77,79,.40),
    0 0 44px rgba(255,77,79,.22),
    inset 0 1px 0 rgba(255,255,255,.12),
    0 12px 28px rgba(0,0,0,.38);
}

/* Optional halo layer (non-intrusive) */
.hmCard.is-done .hmBadge::after,
.hmCard.is-missed .hmBadge::after{
  content:"";
  position:absolute;
  inset:-14px;
  border-radius: 22px;
  pointer-events:none;
  filter: blur(14px);
  opacity:.85;
  z-index:-1;
}
.hmCard.is-done .hmBadge::after{
  background: radial-gradient(circle at 50% 50%, color-mix(in srgb, var(--accent) 55%, transparent), transparent 70%);
}
.hmCard.is-missed .hmBadge::after{
  background: radial-gradient(circle at 50% 50%, rgba(255,77,79,.55), transparent 70%);
}

/* --- Habits matrix: desktop XL overrides --- */
@media (min-width: 1200px){
  /* Make the habits matrix feel like a “board” on large screens:
     bigger cells, softer radius, and a premium glow—visual-only. */
  .matrixWrap{
    padding: 16px;
    border-radius: 22px;
    background:
      radial-gradient(900px 420px at 18% 12%, rgba(99,102,241,.16), transparent 58%),
      radial-gradient(900px 420px at 82% 22%, rgba(34,197,94,.10), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.032), rgba(255,255,255,.014));
    border-color: rgba(255,255,255,.09);
  }
  .matrixWrap::before{
    width: calc(var(--dateCol, 210px) + 16px);
    opacity: .55;
  }

  .matrixGrid{
    gap: 12px;
    --cell: 62px;
    --dateCol: 210px;
  }

  .matrixHeaderRow{
    /* IMPORTANT: keep header columns perfectly aligned with the rows.
       Any horizontal padding here shifts the grid columns and creates the perceived offset. */
    padding: 0;
    border-radius: 18px;
    margin-bottom: 12px;
  }

  .matrixCorner{
    border-radius: 16px;
    min-height: 62px;
  }
  .matrixHabit,
  .matrixDate,
  .matrixDayHead,
  .matrixHabitName{
    border-radius: 16px;
  }

  .matrixCell{
    border-radius: 16px;
    border-color: rgba(255,255,255,.085);
    background:
      radial-gradient(90px 70px at 30% 22%, rgba(255,255,255,.07), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.018));
    box-shadow:
      0 12px 26px rgba(0,0,0,.32),
      inset 0 1px 0 rgba(255,255,255,.07),
      inset 0 0 0 1px rgba(0,0,0,.18);
  }

  .matrixCell:hover{
    transform: translateY(-2px);
    box-shadow:
      0 12px 26px rgba(0,0,0,.32),
      inset 0 1px 0 rgba(255,255,255,.08),
      inset 0 0 0 1px rgba(0,0,0,.18),
      0 0 26px color-mix(in oklab, var(--habit-accent) 35%, transparent);
  }

  .matrixCell.done{
    border-color: color-mix(in oklab, var(--habit-accent) 34%, rgba(255,255,255,.10));
    background:
      radial-gradient(80px 60px at 30% 24%, rgba(255,255,255,.18), transparent 62%),
      linear-gradient(180deg,
        color-mix(in oklab, var(--habit-accent) 54%, transparent),
        color-mix(in oklab, var(--habit-accent) 18%, transparent)
      );
    box-shadow:
      0 12px 26px rgba(0,0,0,.32),
      inset 0 1px 0 rgba(255,255,255,.09),
      inset 0 0 0 1px rgba(0,0,0,.18),
      0 0 36px color-mix(in oklab, var(--habit-accent) 50%, transparent);
  }

  .matrixCell.missed{
    opacity: .72;
  }
}


/* ================================
   Habits: Glass topbar v2 (Dribbble-style)
   - Scoped to .habitsTopbarV2 so it won't affect other segmented controls
   - Recolor via :root --tb-* variables
================================ */
.habitsTopbarV2{ margin-bottom: 14px; }
.habitsTopbarV2 .glassTopbar{
  padding:22px;
  border-radius:26px;
  background:
    radial-gradient(140% 180% at 20% 10%, rgba(255,255,255,.10), transparent 55%),
    linear-gradient(135deg, rgba(255,60,180,.20), rgba(120,70,255,.18));
  border:1px solid var(--tb-stroke);
  box-shadow:
    0 24px 60px rgba(0,0,0,.55),
    0 0 0 1px rgba(255,255,255,.04) inset;
  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);
}

.habitsTopbarV2 .row{
  display:flex;
  align-items:center;
  gap:18px;
}

.habitsTopbarV2 .row-top{ gap:26px; }

.habitsTopbarV2 .segmented{
  display:flex;
  gap:14px;
  align-items:center;
  flex-wrap: wrap;
}

.habitsTopbarV2 .seg{
  border:1px solid var(--tb-stroke2);
  background: rgba(0,0,0,.18);
  color:var(--tb-muted);
  padding:12px 22px;
  border-radius:999px;
  font-weight:700;
  font-size:18px;
  letter-spacing:.2px;
  box-shadow: 0 10px 20px rgba(0,0,0,.25);
  cursor:pointer;
}

.habitsTopbarV2 .seg.is-active{
  color:var(--tb-txt);
  background: linear-gradient(135deg, rgba(140,70,255,.95), rgba(255,80,190,.85));
  border-color: rgba(255,255,255,.18);
  box-shadow:
    0 14px 30px rgba(140,70,255,.22),
    0 10px 24px rgba(255,80,190,.14);
}

.habitsTopbarV2 .add-habit{
  margin-left:auto;
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:14px 26px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.18);
  color:var(--tb-txt);
  font-weight:800;
  font-size:20px;
  background: linear-gradient(135deg, rgba(255,110,60,.95), rgba(255,60,200,.85));
  box-shadow:
    0 18px 40px rgba(255,80,120,.22),
    0 12px 28px rgba(255,160,60,.14);
  cursor:pointer;
}
.habitsTopbarV2 .add-habit:active{ transform: translateY(1px); }

.habitsTopbarV2 .plus{
  width:28px;height:28px;
  display:grid;place-items:center;
  border-radius:10px;
  background: rgba(255,255,255,.14);
  border:1px solid rgba(255,255,255,.16);
  font-weight: 900;
  line-height: 1;
}

.habitsTopbarV2 .row-bottom{
  margin-top:18px;
  padding-top:18px;
  border-top:1px solid rgba(255,255,255,.08);
}

.habitsTopbarV2 .icon-btn{
  width:52px;height:44px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.16);
  color:var(--tb-txt);
  cursor:pointer;
  display:grid;
  place-items:center;
  box-shadow: 0 10px 22px rgba(0,0,0,.25);
}
.habitsTopbarV2 .icon-btn:active{ transform: translateY(1px); }
.habitsTopbarV2 .icon-btn.disabled,
.habitsTopbarV2 .icon-btn:disabled{ opacity:.45; cursor:not-allowed; }

.habitsTopbarV2 .chev{font-size:28px; line-height:1}

.habitsTopbarV2 .habitsDateSlot{ flex: 1 1 auto; min-width: 280px; }
.habitsTopbarV2 .habitsDateRow{ gap:18px; }

.habitsTopbarV2 .date-pill{
  flex: 1 1 auto;
  min-width: 220px;
  padding:14px 18px;
  border-radius:999px;
  text-align:center;
  font-weight:800;
  font-size:22px;
  border:1px solid rgba(255,255,255,.12);
  background: linear-gradient(135deg, rgba(80,120,255,.28), rgba(180,60,255,.20));
  box-shadow: 0 12px 26px rgba(0,0,0,.22);
}

.habitsTopbarV2 .right-tools{
  margin-left:auto;
  display:flex;
  gap:14px;
  align-items:center;
}

.habitsTopbarV2 .tool-btn{
  width:74px;height:50px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.16);
  cursor:pointer;
  box-shadow: 0 10px 22px rgba(0,0,0,.25);
  display:grid;
  place-items:center;
}
.habitsTopbarV2 .tool-btn.active{
  border-color: rgba(255,255,255,.22);
  background: rgba(255,255,255,.08);
}
.habitsTopbarV2 .tool-btn:active{ transform: translateY(1px); }

.habitsTopbarV2 .grid{
  width:26px;height:26px;
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:4px;
}
.habitsTopbarV2 .grid i{
  display:block;
  border-radius:4px;
  background: rgba(255,255,255,.22);
}
.habitsTopbarV2 .grid i:nth-child(1){background: rgba(80,220,255,.75)}
.habitsTopbarV2 .grid i:nth-child(2){background: rgba(180,80,255,.75)}
.habitsTopbarV2 .grid i:nth-child(3){background: rgba(255,210,80,.75)}
.habitsTopbarV2 .grid i:nth-child(4){background: rgba(255,90,170,.75)}

.habitsTopbarV2 .burger{width:26px}
.habitsTopbarV2 .burger i{
  display:block;
  height:3px;
  border-radius:99px;
  background: rgba(255,255,255,.75);
}
.habitsTopbarV2 .burger i+ i{ margin-top:6px; }

/* Responsive: on narrow screens, the Add Habit button drops below */
@media (max-width: 720px){
  .habitsTopbarV2 .row-top{flex-wrap:wrap}
  .habitsTopbarV2 .add-habit{margin-left:0; width:100%; justify-content:center}
  .habitsTopbarV2 .date-pill{font-size:18px}
}

/* Existing month drawer: make it visually compatible with the new bar */
.habitsTopbarV2 .monthInline{
  background: rgba(0,0,0,.14);
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 18px;
}


/* ================================
   Habits Topbar V2 — Mobile layout (matches provided mock)
================================ */
@media (max-width: 560px){
  .habitsTopbarV2 .glassTopbar{
    padding:20px;
    border-radius:30px;
    background:
      radial-gradient(120% 80% at 50% 0%, rgba(255,255,255,.10), transparent 55%),
      linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0)),
      linear-gradient(180deg, var(--tbm-bg1), var(--tbm-bg2));
    border:1px solid rgba(255,255,255,.08);
    box-shadow:0 20px 60px rgba(0,0,0,.60);
  }

  .habitsTopbarV2 .row{ gap:14px; }
  .habitsTopbarV2 .row-top{ gap:14px; }

  /* Hide desktop Add button on small screens (FAB already exists in the app). */
  .habitsTopbarV2 #addHabitDesktop{ display:none !important; }

  /* Tabs: pill container with horizontal scroll */
  .habitsTopbarV2 .segmented{
    gap:10px;
    padding:8px;
    border-radius:24px;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.08);
    flex-wrap:nowrap;
    overflow-x:auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width:none;
  }
  .habitsTopbarV2 .segmented::-webkit-scrollbar{ display:none; }

  .habitsTopbarV2 .seg{
    padding:10px 16px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.15);
    color:var(--tbm-muted);
    font-weight:600;
    font-size:14px;
    letter-spacing:0;
    white-space:nowrap;
    flex:0 0 auto;
    box-shadow:none;
  }
  .habitsTopbarV2 .seg.is-active{
    color:#fff;
    border:0;
    background:linear-gradient(90deg,#7d4cff,#ff4fb3);
    box-shadow:0 8px 22px rgba(255,79,179,.20);
  }

  /* Bottom row: icons left, date nav right */
  .habitsTopbarV2 .row-bottom{
    margin-top:16px;
    padding-top:0;
    border-top:none;
    align-items:center;
  }

  /* Put view tools on the left */
  .habitsTopbarV2 .right-tools{
    margin-left:0;
    order:0;
    gap:12px;
  }

  .habitsTopbarV2 .tool-btn{
    width:56px;
    height:56px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.12);
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    box-shadow:none;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  /* Calendar/date nav to the right */
  .habitsTopbarV2 .habitsDateSlot{
    margin-left:auto;
    order:1;
  }

  .habitsTopbarV2 .habitsDateRow{ gap:10px; }

  .habitsTopbarV2 .icon-btn{
    width:38px;
    height:38px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.16);
    box-shadow:none;
  }

  .habitsTopbarV2 .chev{ font-size:20px; }

  .habitsTopbarV2 .date-pill{
    height:56px;
    padding:0 18px;
    border-radius:999px;
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.10);
    box-shadow:none;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:650;
    font-size:14px;
    white-space:nowrap;
    min-width: 0;
  }
}

@media (max-width: 360px){
  .habitsTopbarV2 .tool-btn{ width:50px; height:50px; }
  .habitsTopbarV2 .date-pill{ height:50px; font-size:13px; padding:0 14px; }
  .habitsTopbarV2 .icon-btn{ width:32px; height:32px; }
  .habitsTopbarV2 .chev{ font-size:18px; }
}
